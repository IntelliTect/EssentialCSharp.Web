<html>
<head>

<style>

    body {
        font-family: 'Times New Roman';
        margin: 0;
    }

    .press-ready-page {
        width: calc(9in - 4px - 0px);
        height: calc(11.13in - 4px - 1px);
        border: 2px solid;
        page-break-after: always;
    }

    .cut-page {
        width: calc(7in);
        height: calc(9.13in);
        margin-top: calc(1in);
        border: 2px solid;
        margin-left: auto;
        margin-right: auto;
    }

    .content-height {
        height: calc(7.32in);
        margin-top: calc(0.75in);
        margin-bottom: calc(1.06in);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .page-width {
        width: calc(7in);
        margin: auto;
        border: solid;
        border-left-width: 2px;
        border-right-width: 2px;
        border-top-width: 0;
        border-bottom-width: 0;
    }

    .page-left-larger-side-margins {
        margin-left: calc(1.25in);
        margin-right: calc(0.75in);
    }

    .page-right-larger-side-margins {
        margin-right: calc(1.25in);
        margin-left: calc(0.75in);
    }

    .footnotes-top-section {
        height: 10px;
        margin-top: calc(30px - 10px);
    }

    .footnotes-top-line {
        margin: 0;
    }

    .element-section {
        overflow-y: hidden;
    }

    .chapter-number-container {
        height: 0.39in;
    }

    .chapter-number-squares {
        position: absolute;
        height: 37px;
    }

    .chapter-number {
        position: absolute;
        width: 60px;
        margin-left: 0.45in;
        font-size: 36pt;
        font-weight: bold;
        margin-top: -7px;
        text-align: left;
    }

    .double-digit-chapter .chapter-number {
        margin-left: 0.45in
    }

    .chapter-title {
        font-size: 22pt;
        margin-block-start: 10px;
        margin-block-end: 0px;
        letter-spacing: -1.0pt;
    }

    .chapter-title-underline {
        border-bottom: solid silver 3pt;
        padding: 0 0 7pt 0;
        margin-bottom: 66pt;
    }

    p {
        font-size: 10.5pt;
        text-align: justify;
        text-indent: 0.21in;
        line-height: 15.5pt;
        margin-block-start: 0;
        margin-block-end: 0;
    }

    .section-heading {
        font-family: 'Arial Black';
        font-weight: bold;
    }

    .H1 {
        line-height: 15.5pt;
        margin-top: 23.25pt;
        margin-bottom: 7.75pt;
        font-size: 12pt;
    }

    .H1 .CITchapbm {
        font-size: 12pt
    }

    .H2 {
        line-height: 15.5pt;
        margin-top: 15.5pt;
        margin-bottom: 3pt;
        font-size: 10.5pt;
    }

    .H3 {
        line-height: 15pt;
        margin-top: 15pt;
        margin-bottom: 2pt;
        font-size: 10pt;
        font-style: italic;
    }

    .SummaryHead {
        font-size: 12pt;
        border-bottom: 1.5pt solid black;
        margin-top: 23.25pt;
        margin-bottom: 7.75pt;
        line-height: 15.5pt;
    }

    .HEADFIRST, .CHAPBMFIRST {
        text-indent: 0;
    }

    .DCAP {
        font-variant: small-caps;
    }

    .code-block-top-section {
        margin-top: calc(15px);
    }

    .code-block-bottom-section {
        
        margin-bottom: calc(15px);
        border-bottom: solid black calc(1px);
        padding-bottom: calc(5px);
    }

    .code-block-section, .TableCDT1, .TableCDT, .TableCDTX, .CDTMID, .NLDPGMONLY, .DPGMONLY, .TableDPGMFIRST, .TableDPGM, .TableDPGMLAST, .CITchapbm, .SF1DPGMONLY, .CPComment, .TABLEDPGMMID, .DPGMFIRST, .DPGMMID, .DPGMLAST {
        font-family: 'Courier New';
        font-size: 8pt;
    }

    .DPGMFIRST {
        margin-top: 8px;
    }

    .DPGMFIRST, .DPGMMID, .DPGMLAST {
        line-height: 10pt;
    }

    .DPGMLAST {
        margin-bottom: 8px;
    }

    .code-block-heading {
        line-height: 12.0pt;
        font-weight: bold;
        border-bottom: solid black calc(1px);
        font-family: 'Arial';
        margin-bottom: 6pt;
    }

    .code-line {
        margin-left: 15pt;
        line-height: 11pt;
        word-break: break-all;
    }

    .CDThighlight {
        background: #ededed;
    }

    .CDTNUM {
        font-family: "Arial";
        font-variant: small-caps;
    }

    .CPKeyword {
        color: blue;
        letter-spacing: 0pt;
        font-weight: bold;
    }

    .Maroon {
        color: #A31515;
    }

    .Teal {
        color: #2B91AF;
    }

    .disable-indent {
        text-indent: 0 !important;
    }

    .justify-last {
        text-align-last: justify;
    }

    .output-block-heading {
        font-family: Arial;
        color: black;
        font-size: 8pt;
        margin-bottom: 5pt;
        font-weight: 600;
        font-variant: small-caps;
    }

    .output-line {
        word-break: break-word;
    }

    .output-block-section .output-block-lines {
        font-family: courier new;
        font-size: 8pt;
        background : #e9e9e9;
        color: #36454f;
        padding-left: calc(9px);
        padding-right: calc(9px);
    }

    .output-block-top-section {
        margin-top: calc(11px);
    }

    .output-block-top-section .output-block-lines {
        padding-top: calc(9px);
    }

    .first-element .output-block-section .output-block-lines {
        padding-top: calc(9px);
    }

    .output-block-bottom-section {
        margin-bottom: calc(11px);
    }

    .output-block-bottom-section .output-block-lines {
        padding-bottom: calc(9px);
    }

    .last-element .output-block-section .output-block-lines {
        padding-bottom: calc(9px);
    }

    .BOLD {
        font-weight: bolder;
        color: black;
    }

    .figure-image {
        width: 100%;
    }

    .figure-heading {
        margin-top: 12pt;
        margin-right: 0;
        margin-bottom: 0.25in;
        margin-left: 0;
        line-height: 12.0pt;
        font-size: 8pt;
        font-family: "Arial",sans-serif;
        font-weight: bold;
    }

    .FIGNUM {
        font-variant: small-caps;
    }

    .footnote-block {
        font-size: 9pt;
    }

    .Superscript {
        position: relative;
        top: -3pt;
        font-size: 8pt;
    }

    .ordered-list-item-paragraph {
        line-height: 12.0pt;
        padding-bottom: 8pt;
        font-size: 10.5pt;
    }

    .ordered-list-item-paragraph:last-child {
        padding-bottom: 0;
    }

    .ordered-list-item {
        display: flex;
        margin-top: 7px;
        margin-left: 15px;
    }

    .ordered-list-item-content {
        flex: 25;
    }

    .ordered-list-item-number {
       flex: 1;
    }

    .DPGMONLY {
        text-indent: unset;
        padding-left: 20px;
    }

    .skill-topic-heading {
        font-family: "Arial Narrow";
        font-size: 10.5pt;
        letter-spacing: 2pt;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 6pt;
        margin-left: .17in;
    }

    .skill-topic-block-top {
        margin-top: calc(20px);
    }

    .skill-topic-block-bottom {
        margin-bottom: calc(20px);
    }

    .page-right-larger-side-margins .skill-topic-block{
        border-left: 6pt solid silver;
        padding-left: 10pt;
    }

    .page-left-larger-side-margins .skill-topic-block{
        border-right: 6pt solid silver;
        padding-right: 10pt;
    }

    .skill-topic-sub-heading {
        font-size: 10.5pt;
        font-family: "Arial Black";
        font-weight: bold;
        padding-top: 6px;
    }

    .skill-topic-block .paragraph{
        text-indent: 0;
        margin-top: 6pt;
    }

    .skill-topic-block .first-line{
        text-indent: 0;
    }

    .skill-topic-overlayed-squares{
        position: absolute;
        height: 12px;
        margin-top: .03in;
    }

    .guidelines-block {
        background : #eaeaea;
        font-family: Arial;
        margin-top: 10pt;
        margin-bottom: 4pt;
        margin-left: auto;
        margin-right: auto;
        width: 80%
    }
    
    .inside-guidelines-block {
        margin-left: 11pt;
        margin-bottom: 6pt;
        margin-right: 10pt;
        margin-top: -2pt;
    }

    .guidelines-block-heading {
        font-family: Arial black;
        font-size: 12pt;
        padding-bottom: 7pt;
    }

    .guidelines-block-lines {
        font-size: 9pt;
        line-height: 1.4;
    }

    .guidelines-block-line {
        margin-bottom: 2pt;
    }

    .language-contrast-block {
        background : #eaeaea;
        font-family: Arial;
        margin-top: 10pt;
        margin-bottom: 10pt;
    }

    .inside-language-contrast-block {
        margin-left: 11pt;
        margin-bottom: 10pt;
        margin-right: 10pt;
        margin-top: -2pt;
    }

    .language-contrast-heading {
        font-family: Arial black;
        font-size: 12pt;
        padding-bottom: 7pt;
    }

    .language-contrast-lines {
        font-size: 9pt;
        line-height: 1.4;
    }

    .language-contrast-line {
        margin-bottom: 2pt;
    }

    .upper-left-square {
        width: 11px;
        height: 11px;
    }

    .light-gray-square {
        background: #cbcbcb;
    }

    .dark-gray-square {
        background: #6b6f72;
    }

    .table-row {
        margin-bottom: -2px;
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }

    .table-cell {
        margin: 0;
    }

    .CITTBL {
        font-family: 'Courier New';
        font-size: 8pt;   
        margin-top: 5.5pt;
        margin-bottom: 5.5pt;
        padding: 0in 2.9pt 0in 2.9pt;
        text-indent:unset;
    }

    .TBL {
        margin: 0px;
        line-height: 11.0pt;
        font-size: 9.0pt;
        font-family: "Times New Roman",serif;
        color: black;
        text-indent: unset;
    }

    .table-heading {
        margin-right: 0in;
        margin-bottom: 3pt;
        margin-left: 0in;
        line-height: 15.5pt;
        font-size: 8.0pt;
        font-family: "Arial",sans-serif;
        color: black;
        font-weight: bold;
        margin-top: 20px;
    }

    .table-top-row .table-row-container{
        border-top: 1px solid black;
    }

    .table-bottom-row{
        border-bottom: 1px solid black;
    }

    .left-table-cell {
        border-left: 1px solid black;
    }

    .right-table-cell {
        border-right: 1px solid black;
    }

    .standard-table-cell {
        padding: 6px;
        border-top: 1px black solid;
        border-bottom: 1px black solid;
        vertical-align: top;
    }

    .table-top-row .standard-table-cell {
        border-top: none;
    }

    .table-header-row .standard-table-cell {
        border-top: none;
        vertical-align: bottom;
    }

    .standard-table-cell p {
        text-align: left;
        text-indent: unset;
        line-height: 10pt;
    }
    .non-standard-cell {
        padding-bottom: 6px;
    }

    .final-row {
        background: #e9e9e9;
        border: 1px solid black;
        height: 8px;
    }

    .final-row .standard-table-cell {
        padding: 0;
    }

    .TBLCOLHD {
        line-height: 10pt ;
        font-size: 8pt;
        font-family: "Arial",sans-serif;
        color: black;
        font-weight: bold;
        text-align: left;
        text-indent: unset;
    }

    .header-row
    {
        background: #E6E6E6;
    }

    .table-final-row {
        margin-bottom: 20px;
    }

    .note-block {
        border-style: solid;
        border-width:5px;
        border-color: #808080; 
        background : #EAEAEA;
        font-family: Arial;
        margin-top: 10pt;
        margin-bottom: 4pt;
        margin-left: auto;
        margin-right: auto;
    }
    
    .inside-note-block {
        margin-left: 11pt;
        margin-bottom: 6pt;
        margin-right: 10pt;
        margin-top: -2pt;
    }
    .table-top-row .standard-table-cell p {
        margin-left: -4px;
        margin-right: -4px;
    }
    .note-block {
        border-style: solid;
        border-width:5px;
        border-color: #808080; 
        background : #EAEAEA;
        font-family: Arial;
        margin-top: 10pt;
        margin-bottom: 4pt;
        margin-left: auto;
        margin-right: auto;
    }
    
    .inside-note-block {
        margin-left: 11pt;
        margin-bottom: 6pt;
        margin-right: 10pt;
        margin-top: -2pt;
    }


    .note-block-heading {
        position: relative;
        font-family: Arial black;
        font-size: 12pt;
        padding-bottom: 7pt;
        padding-top: 3pt;
        text-transform: uppercase;
        margin-left: .17in;
    }

    .note-block-lines {
        font-family: "Times New Roman",Serif;
        font-size: 11pt;
        line-height: 1.4;
    }

    .note-block-line {
        margin-bottom: 2pt;
    }

    .note-block-heading {
        position: relative;
        font-family: Arial black;
        font-size: 12pt;
        padding-bottom: 7pt;
        padding-top: 3pt;
        text-transform: uppercase;
        margin-left: .17in;
    }
    .note-block-line-bold {
        margin-bottom: 2pt;
        font-weight: bold;
    }

    .note-block-lines {
        font-family: "Times New Roman",Serif;
        font-size: 11pt;
        line-height: 1.4;
    }

    .note-block-line {
        margin-bottom: 2pt;
    }

    .note-block-line-bold {
        margin-bottom: 2pt;
        font-weight: bold;
    }

    .note-block-overlayed-squares {
        position: absolute;
        height: 12px;
        margin-top: .11in;
    }

    .CPComment {
        color: green;
        font-style: italic;
    }

    .ITAL {
        font-style: italic;
    }

</style><script>

    // https://stackoverflow.com/questions/10787782/full-height-of-a-html-element-div-including-border-padding-and-margin
    function getAbsoluteHeight(el) {
        // Get the DOM Node if you pass in a string
        el = (typeof el === 'string') ? document.querySelector(el) : el;

        const styles = window.getComputedStyle(el);
        const margin = parseFloat(styles['marginTop']) +
            parseFloat(styles['marginBottom']);

        return Math.ceil(el.offsetHeight + margin);
    }

     function getAbsoluteWidth(el) {
        // Get the DOM Node if you pass in a string
        el = (typeof el === 'string') ? document.querySelector(el) : el;

        const styles = window.getComputedStyle(el);
        const margin = parseFloat(styles['marginLeft']) +
            parseFloat(styles['marginRight']);

        const width = el.offsetWidth + margin;

        return width;
    }

    function measureSingleSectionElement(id) {

        const element = document.querySelector(`[data-element-id='${id}']`);

        const heightInPixels = getAbsoluteHeight(element);

        return {
            id,
            heightInPixels
        };
    }

    function measureLinesInElement(id) {
        const element = document.querySelector(`[data-element-id='${id}']`);

        const heightInPixels = getAbsoluteHeight(element);

        const wordElements = element.getElementsByTagName('fakeTag');

        const lineHeight = parseFloat(document.defaultView.getComputedStyle(element, null).getPropertyValue("line-height"));

        const lines = [];
        let line = null;
        let lineWords = [];
        let lineLeft = 0;

        for (const word of wordElements) {
            if ((line == null) || word.getBoundingClientRect().left < lineLeft) {
                if (line != null) {

                    line.heightInPixels = measureLineHeight(lineWords);
                    lineWords = [];

                    lines.push(line);
                }
                line = {
                    firstWordId: word.dataset.taggedWordId,
                    heightInPixelsOld: lineHeight
                };
            }

            lineWords.push(word);
            line.lastWordId = word.dataset.taggedWordId;
            lineLeft = word.getBoundingClientRect().left;
        }

        if (line != null) {
            line.heightInPixels = measureLineHeight(lineWords);
            lines.push(line);
        }

        if(lines.length > 0){
            const styles = window.getComputedStyle(element)
            const topLineExtra = parseFloat(styles['marginTop']) + parseFloat(styles['paddingTop']);
            const bottomLineExtra = parseFloat(styles['marginBottom']) + parseFloat(styles['paddingBottom']);
            lines[0].heightInPixels += topLineExtra;
            lines[lines.length - 1].heightInPixels += bottomLineExtra;
        }

        return {
            id,
            heightInPixels,
            lines
        };
    }

    function measureLineHeight(lineWords){
        let lineWrapper = document.createElement('fakeLine');

        lineWords[0].parentNode.insertBefore(lineWrapper, lineWords[0]);

        for (const lineWord of lineWords){
            lineWrapper.appendChild(lineWord);
        }

        lineWrapper.style.display = 'block';
        lineWrapper.style.textIndent = 0;

        const lineHeight = getAbsoluteHeight(lineWrapper);

        lineWrapper.style.display = null;
        lineWrapper.style.textIndent = null;


        return lineHeight;
    }

    function highlightSizeMiscalculations(threshold = 2){
        const elements = document.querySelectorAll(`[data-calculated-height]`);

        let pixelsOverEstimated = 0;
        let pixelsUnderEstimated = 0;

        for (const element of elements){
            const calculatedHeight = element.dataset.calculatedHeight;

            element.style.overflowY = 'hidden';
            
            const actualHeight = getAbsoluteHeight(element);

            const heightDifference = calculatedHeight - actualHeight;
            const absoluteHeightDifference = Math.abs(heightDifference);

            element.dataset.heightDifference = heightDifference;

            // ignoring a small difference due to rounding issues
            if(absoluteHeightDifference < threshold) {
                element.style.backgroundColor = 'transparent';
                continue;
            }

            for(const child of element.children){
                child.style.position = 'relative';
                child.style.zIndex = -1;
            }

            const clampedColorDifference = Math.max(0, 220 - absoluteHeightDifference * 10);

            if(heightDifference > 1){                    
                pixelsOverEstimated += absoluteHeightDifference;
                element.style.backgroundColor = `rgba(${clampedColorDifference}, 255, ${clampedColorDifference}, 0.4)`;
            }else  if(heightDifference < -1){
                
                pixelsUnderEstimated += absoluteHeightDifference;
                element.style.backgroundColor = `rgba(255, ${clampedColorDifference}, ${clampedColorDifference}, 0.4)`;
            } 
        }

        console.log(`Over estimated: ${pixelsOverEstimated} pixels`);
        console.log(`Under estimated: ${pixelsUnderEstimated} pixels`);
        console.log(`Total miscalulation: ${pixelsOverEstimated - pixelsUnderEstimated} pixels`);
    }

    function measureCellWidth(id){
       const element = document.querySelector(`[data-element-id='${id}']`);

       const widthInPixels = getAbsoluteWidth(element);

       return {
           id,
           widthInPixels
       };
    }
</script></head>

<body>
    <div class="page-width">
        <div class="page-left-larger-side-margins">



<div data-element-id="24f98407-ed92-4154-8c1e-f24bf29f1f72" class="element-section CHAPTTL">
    
        <div class="chapter-number-container double-digit-chapter">
            <img class="chapter-number-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMzcwIiBoZWlnaHQ9IjEyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;PGRlZnM&#x2B;PGNsaXBQYXRoIGlkPSJjbGlwMCI&#x2B;PHJlY3QgeD0iNDEzIiB5PSIyNzkiIHdpZHRoPSIzNzAiIGhlaWdodD0iMTIyIi8&#x2B;PC9jbGlwUGF0aD48L2RlZnM&#x2B;PGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwKSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQxMyAtMjc5KSI&#x2B;PHJlY3QgeD0iNDE1IiB5PSIyNzkiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iI0IyQjJCMiIvPjxyZWN0IHg9IjQxMyIgeT0iMzQ2IiB3aWR0aD0iNTUiIGhlaWdodD0iNTUiIGZpbGw9IiMzMzMzMzMiLz48cmVjdCB4PSI0NjgiIHk9IjI3OSIgd2lkdGg9IjU1IiBoZWlnaHQ9IjU1IiBmaWxsPSIjRUFFQUVBIi8&#x2B;PHJlY3QgeD0iNzI3IiB5PSIzNDUiIHdpZHRoPSI1Ni4wMDAxIiBoZWlnaHQ9IjU2IiBmaWxsPSIjOTY5Njk2Ii8&#x2B;PC9nPjwvc3ZnPg=="/>
            <div class="chapter-number">12</div>
        </div>

    <div class="chapter-title-underline">
        <h1 class="chapter-title">Generics</h1>
    </div>
</div>




























<p data-element-id="a3e14da5-4aff-4dd5-91a8-d8bfb6b44e49" class="element-section paragraph CHAPBMFIRST" >
<span class="SCAP">As your projects become more sophisticated</span>, you will need a better way to reuse and customize existing software. To facilitate code reuse, especially the reuse of algorithms, C# includes a feature called <span class="BOLD">generics</span>. </p>














<p data-element-id="f09e3cd7-bc48-44f4-86a1-05fa6ecc3bde" class="element-section paragraph CHAPBM" >
Generics are lexically like generic types in Java and templates in C&#x2B;&#x2B;. In all three languages, these features enable the implementation of algorithms and patterns once, rather than requiring separate implementations for each type that the algorithm or pattern operates on. However, C# generics are very different from both Java generics and C&#x2B;&#x2B; templates in the details of their implementation and impact on the type system of their respective languages. Just as methods are powerful because they can take arguments, so types and methods that take type arguments have significantly more functionality.</p>














<p data-element-id="62c7d38a-4227-4992-92da-7e664ccd83b6" class="element-section paragraph CHAPBM" >
Generics were added to the runtime and C# in version 2.0.</p>















<div data-element-id="59aef059-a7f6-48b7-b258-4144f554df89" class="element-section section-heading H1">
C# without Generics</div>













<p data-element-id="b65fa183-38ce-4214-adcb-cf98839cb378" class="element-section paragraph HEADFIRST" >
We begin the discussion of generics by examining a class that does not use generics. This class, <span class="CITchapbm">System.Collections.Stack</span>, represents a collection of objects such that the last item to be added to the collection is the first item retrieved from the collection (last in, first out [LIFO]). <span class="CITchapbm">Push()</span> and <span class="CITchapbm">Pop()</span>, the two main methods of the <span class="CITchapbm">Stack</span> class, add items to the stack and remove them from the stack, respectively. The declarations for the methods on the <span class="CITchapbm">Stack</span> class appear in Listing 12.1.</p>















<div data-element-id="bb2ea5bc-26b6-483b-952d-fa2443d409f1" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.1:</span>&#x2002;The <span class="CITchapbm">System.Collections.Stack</span> Method Signatures    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public class</span> Stack            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;   <span class="CPKeyword">public</span> <span class="CPKeyword">virtual</span> <span class="CPKeyword">object</span> Pop() { ... }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;   <span class="CPKeyword">public</span> <span class="CPKeyword">virtual</span> <span class="CPKeyword">void</span> Push(<span class="CPKeyword">object</span> obj) { ... }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;   <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="c377379a-7671-494f-89c0-88eb77b18980" class="element-section paragraph CHAPBMCON" >
Programs frequently use stack type collections to facilitate multiple undo operations. For example, Listing 12.2 uses the <span class="CITchapbm">System.Collections.Stack</span> class for undo operations within a program that simulates an Etch A Sketch toy.</p>















<div data-element-id="ba06aaf4-8208-4376-bf14-6553c6d8729f" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.2:</span>&#x2002;Supporting Undo in a Program Similar to an Etch A Sketch Toy    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">using</span> System.Collections;            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Program            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">void</span> Sketch()            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Stack path = <span class="CPKeyword">new</span> Stack();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Cell currentPosition;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ConsoleKeyInfo key;  <span class="CPComment">// Added in C# 2.0</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">do</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPComment">// Etch in the direction indicated by the</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPComment">// arrow keys that the user enters</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          key = Move();            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">switch</span> (key.Key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.Z:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPComment">// Undo the previous Move</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">if</span> (path.Count &gt;= 1)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      currentPosition = (Cell)path.Pop();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Console.SetCursorPosition(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                          currentPosition.X, currentPosition.Y);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Undo();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.DownArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.UpArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.LeftArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.RightArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPComment">// SaveState()</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  currentPosition = <span class="CPKeyword">new</span> Cell(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Console.CursorLeft, Console.CursorTop);            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  path.Push(currentPosition);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">default</span>:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  Console.Beep();  <span class="CPComment">// Added in C# 2.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">while</span> (key.Key != ConsoleKey.X);  <span class="CPComment">// Use X to quit</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Cell            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// Use read-only field prior to C# 6.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">int</span> X { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">int</span> Y { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> Cell(<span class="CPKeyword">int</span> x, <span class="CPKeyword">int</span> y)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        X = x;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Y = y;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="77eae8a9-707d-4719-b4ae-c7b750449a4c" class="element-section paragraph CHAPBMCON" >
The results of Listing 12.2 appear in Output 12.1.</p>














<p data-element-id="d6f2982e-d899-4f79-8f7f-351fc8a1e826" class="element-section paragraph CHAPBM" >
Using the variable <span class="CITchapbm">path</span>, which is declared as a <span class="CITchapbm">System.Collections.Stack</span>, you save the previous move by passing a custom type, <span class="CITchapbm">Cell</span>, into the <span class="CITchapbm">Stack.Push()</span> method using <span class="CITchapbm">path.Push(currentPosition)</span>. If the user enters a <span class="ITAL">Z</span> (or presses Ctrl&#x2B;Z), you undo the previous move by retrieving it from the stack using a <span class="CITchapbm">Pop()</span> method, setting the cursor position to be the previous position, and calling <span class="CITchapbm">Undo()</span>.</p>














<p data-element-id="5d6cf382-61d5-434c-825d-68afd588ba1b" class="element-section paragraph CHAPBM" >
Although this code is functional, the <span class="CITchapbm">System.Collections.Stack</span> class has a fundamental shortcoming. As shown in Listing 12.1, the <span class="CITchapbm">Stack</span> class collects values of type <span class="CITchapbm">object</span>. Because every object in the Common Language Runtime (CLR) derives from <span class="CITchapbm">object</span>, <span class="CITchapbm">Stack</span> provides no validation that the elements you place into it are homogenous or are of the intended type. For example, instead of passing <span class="CITchapbm">currentPosition</span>, you can pass a string in which <span class="CITchapbm">X</span> and <span class="CITchapbm">Y</span> are concatenated with a decimal point between them. However, the compiler must allow the inconsistent data types because the stack class is written to take any object, regardless of its more specific type.</p>














<p data-element-id="421b2fc8-0164-4cc1-8d9e-335a4143990c" class="element-section paragraph CHAPBM" >
Furthermore, when retrieving the data from the stack using the <span class="CITchapbm">Pop()</span> method, you must cast the return value to a <span class="CITchapbm">Cell</span>. But if the type of the value returned from the <span class="CITchapbm">Pop()</span> method is not <span class="CITchapbm">Cell</span>, an exception is thrown. By deferring type checking until runtime by using a cast, you make the program more brittle. The fundamental problem with creating classes that can work with multiple data types without generics is that they must work with a common base class (or interface), usually <span class="CITchapbm">object</span>.</p>














<p data-element-id="0daf3961-a35a-4633-9d42-953adcfed9c1" class="element-section paragraph CHAPBM" >
Using value types, such as a struct or an integer, with classes that use <span class="CITchapbm">object</span> exacerbates the problem. If you pass a value type to the <span class="CITchapbm">Stack.Push()</span> method, for example, the runtime automatically boxes it. Similarly, when you retrieve a value type, you need to explicitly unbox the data and cast the <span class="CITchapbm">object</span> reference you obtain from the <span class="CITchapbm">Pop()</span> method into a value type. Casting a reference type to a base class or interface has a negligible performance impact, but the box operation for a value type introduces more overhead, because it must allocate memory, copy the value, and then later garbage-collect that memory.</p>














<p data-element-id="f38d9f97-fedb-42b5-8a3b-bc1d1d287a82" class="element-section paragraph CHAPBM" >
C# is a language that encourages <span class="ITAL">type safety</span>: The language is designed so that many type errors, such as assigning an integer to a variable of type <span class="CITchapbm">string</span>, can be caught at compile time. The fundamental problem is that the <span class="CITchapbm">Stack</span> class is not as type-safe as one expects a C# program to be. To change the <span class="CITchapbm">Stack</span> class to enforce type safety by restricting the contents of the stack to be a particular data type (without using generic types), you must create a specialized <span class="CITchapbm">stack</span> class, as in Listing 12.3.</p>















<div data-element-id="ad6c1e23-00a4-4e31-9e53-7969148e53ba" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.3:</span>&#x2002;Defining a Specialized Stack Class    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> CellStack            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">virtual</span> Cell Pop();            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">virtual</span> <span class="CPKeyword">void</span> Push(Cell cell);            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="3055db49-7137-4de6-a428-4d4d39324e56" class="element-section paragraph CHAPBM" >
Because <span class="CITchapbm">CellStack</span> can store only objects of type <span class="CITchapbm">Cell</span>, this solution requires a custom implementation of the stack methods, which is less than ideal. Implementing a type-safe stack of integers would require yet another custom implementation; each implementation would look remarkably like every other one. There would be lots of duplicated, redundant code.</p>





















<div data-element-id="34003d33-92a6-485f-9318-b227cd6e1021" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">Beginner Topic</div>
    <div class="skill-topic-sub-heading">Another Example: Nullable Value Types</div>





<p data-element-id="1b983550-8a2e-4013-846e-5a566853fa70" class="element-section paragraph SF1FIRST" >
Chapter 3 introduced the capability of declaring variables that could contain <span class="CITchapbm">null</span> by using the nullable modifier, <span class="CITchapbm">?</span>, when declaring a value type variable. C# began supporting this functionality only in version 2.0, because the right implementation required generics. Prior to the introduction of generics, programmers faced essentially two options.</p>














<p data-element-id="cbe148ca-ec58-4e5a-81d6-b8bb4afcd4da" class="element-section paragraph SF1MID" >
The first option was to declare a nullable data type for each value type that needs to handle <span class="CITchapbm">null</span> values, as shown in Listing 12.4.</p>















<div data-element-id="b1c4a61d-fafb-4b5b-b0bb-ae9d2818c20d" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.4:</span>&#x2002;Declaring Versions of Various Value Types That Store <span class="CITchapbm">null</span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">struct</span> NullableInt            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Provides the value when HasValue returns true</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">int</span> Value{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Indicates whether there is a value or whether</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// the value is </span><span class="Maroonital">&quot;null&quot;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">bool</span> HasValue{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    // ...</span>            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">struct</span> NullableGuid            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Provides the value when HasValue returns true</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> Guid Value{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Indicates whether there is a value or whether</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// the value is </span><span class="Maroonital">&quot;null&quot;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">bool</span> HasValue{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
...            </div>
    </div>
</div>













<p data-element-id="93b77406-4cf2-4286-b815-881ad7207d62" class="element-section paragraph SF1MID" >
Listing 12.4 shows possible implementations of <span class="CITchapbm">NullableInt</span> and <span class="CITchapbm">NullableGuid</span>. If a program required additional nullable value types, you would have to create yet another struct with the properties modified to use the desired value type. Any improvement of the implementation (e.g., adding a user-defined implicit conversion from the underlying type to the nullable type) would require modifying all the nullable type declarations.</p>














<p data-element-id="fca3987e-9d31-4cc8-afb6-bf2ff7098492" class="element-section paragraph SF1MID" >
An alternative strategy for implementing a nullable type without generics is to declare a single type with a <span class="CITchapbm">Value</span> property of type <span class="CITchapbm">object</span>, as shown in Listing 12.5.</p>















<div data-element-id="6e3a36b4-84b9-4c08-9381-5de07f931227" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.5:</span>&#x2002;Declaring a Nullable Type That Contains a <span class="CITchapbm">Value</span> Property of Type <span class="CITchapbm">object</span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">struct</span> Nullable            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Provides the value when HasValue returns true</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">object</span> Value{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;summary&gt;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// Indicates whether there is a value or whether</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// the value is </span><span class="Maroonital">&quot;null&quot;</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;    /// &lt;/summary&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">bool</span> HasValue{ <span class="CPKeyword">get</span>; private <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="81d4eb8b-debd-4cb9-86e4-63cb1baddfef" class="element-section paragraph SF1MID" >
Although this option requires only one implementation of a nullable type, the runtime always boxes value types when setting the <span class="CITchapbm">Value</span> property. Furthermore, retrieving the underlying value from the <span class="CITchapbm">Value</span> property requires a cast operation, which might potentially be invalid at runtime.</p>














<p data-element-id="8ad69f6e-5c88-4c39-89bc-c09803c025e9" class="element-section paragraph SF1LAST" >
Neither option is particularly attractive. To eliminate this problem, C# 2.0 introduced generics to C#. (And, in fact, nullable types are implemented as the generic type <span class="CITchapbm">Nullable&lt;T&gt;</span>.)</p>










</div>








<div data-element-id="cefd867b-e462-4eea-a586-f4adc13c6791" class="element-section section-heading H1">
Introducing Generic Types</div>













<p data-element-id="422610c0-df77-49ac-9463-3f2165a28c99" class="element-section paragraph HEADFIRST" >
Generics provide a facility for creating data structures that can be specialized to handle specific types. Programmers define these <span class="BOLD">parameterized types </span>so that each variable of a particular generic type has the same internal algorithm, but the types of data and method signatures can vary on the basis of the type arguments provided for the type parameters.</p>














<p data-element-id="0f2be5bf-15b0-4c74-b265-a8a05f2e47ed" class="element-section paragraph CHAPBM" >
To minimize the learning curve for developers, the C# designers chose syntax that superficially resembles C&#x2B;&#x2B; templates. In C#, the syntax for generic classes and structures uses angle brackets to both declare the generic type parameters in the type declaration and specify the generic type arguments when the type is used.</p>















<div data-element-id="af6ed83e-b342-45e2-bd83-50979e5c83a6" class="element-section section-heading H2">
Using a Generic Class</div>













<p data-element-id="cd8b4570-5873-4000-b765-a190cebde552" class="element-section paragraph HEADFIRST" >
Listing 12.6 shows how you can specify the actual type argument used by the generic class. You instruct the <span class="CITchapbm">path</span> variable to be the &#x201C;Stack of Cell&#x201D; type by specifying <span class="CITchapbm">Cell</span> within angle bracket notation in both the object creation expression and the declaration statement. In other words, when declaring a variable (<span class="CITchapbm">path</span> in this case) using a generic data type, C# requires the developer to identify the actual type arguments used by the generic type. Listing 12.6 illustrates this process with the new generic <span class="CITchapbm">Stack</span> class.</p>















<div data-element-id="6c7cc0a1-cdae-4f54-a395-c5a18e83b1ef" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.6:</span>&#x2002;Implementing Undo with a Generic <span class="CITchapbm">Stack</span> Class    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">using</span> System;            </div>
            <div class='code-line '>
<span class="CPKeyword">using</span> System.Collections.Generic;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Program            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">void</span> Sketch()            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Stack&lt;Cell&gt; path;          <span class="CPComment">// Generic variable declaration</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      path = <span class="CPKeyword">new</span> Stack&lt;Cell&gt;();  <span class="CPComment">// Generic object instantiation</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Cell currentPosition;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ConsoleKeyInfo key;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">do</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPComment">// Etch in the direction indicated by the</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">                   // arrow keys entered by the user</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          key = Move();            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">switch</span> (key.Key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.Z:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPComment">// Undo the previous Move</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">if</span> (path.Count &gt;= 1)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="CPComment">// No cast required</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      currentPosition = path.Pop();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Console.SetCursorPosition(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                          currentPosition.X, currentPosition.Y);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Undo();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.DownArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.UpArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.LeftArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> ConsoleKey.RightArrow:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPComment">// SaveState()</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  currentPosition = <span class="CPKeyword">new</span> Cell(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Console.CursorLeft, Console.CursorTop);            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPComment">// Only type Cell allowed in call to Push()</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  path.Push(currentPosition);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">default</span>:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  Console.Beep();  <span class="CPComment">// Added in C# 2.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      } <span class="CPKeyword">while</span> (key.Key != ConsoleKey.X);  <span class="CPComment">// Use X to quit</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="4cde6ffc-1b04-477b-9580-4c17e161bde0" class="element-section paragraph CHAPBM" >
The results of Listing 12.6 appear in Output 12.2.</p>














<p data-element-id="eb4f7c25-c5a1-4f6f-a370-190fc58b9787" class="element-section paragraph CHAPBM" >
</p>














<p data-element-id="c0d789f4-18a5-4b7a-9547-e9d8cc223001" class="element-section paragraph CHAPBM" >
In the <span class="CITchapbm">path</span> declaration shown in Listing 12.6, you declare a variable and initialize it with a new instance of the <span class="CITchapbm">System.Collections.Generic.Stack&lt;Cell&gt;</span> class. You specify in angle brackets that the data type of the stack&#x2019;s elements is <span class="CITchapbm">Cell</span>. As a result, every object added to and retrieved from <span class="CITchapbm">path</span> is of type <span class="CITchapbm">Cell</span>. In turn, you no longer need to cast the return of <span class="CITchapbm">path.Pop()</span> or ensure that only <span class="CITchapbm">Cell</span> type objects are added to <span class="CITchapbm">path</span> in the <span class="CITchapbm">Push()</span> method.</p>















<div data-element-id="e3595e79-ec33-4e2b-b200-57fbd73f34d5" class="element-section section-heading H2">
Defining a Simple Generic Class</div>













<p data-element-id="666c531f-f6f9-4a62-9c67-03516a376ef8" class="element-section paragraph HEADFIRST" >
Generics allow you to author algorithms and patterns and to reuse the code for different data types. Listing 12.7 creates a generic <span class="CITchapbm">Stack&lt;T&gt;</span> class similar to the <span class="CITchapbm">System.Collections.Generic.Stack&lt;T&gt;</span> class used in the code in Listing 12.6. You specify a <span class="BOLD">type parameter </span>(in this case, <span class="CITchapbm">T</span>) within angle brackets after the class name. The generic <span class="CITchapbm">Stack&lt;T&gt;</span> can then be supplied with a single type argument that is substituted everywhere <span class="CITchapbm">T</span> appears in the class. Thus, the stack can store items of any stated type, without duplicating code or converting the item to type <span class="CITchapbm">object</span>. The type parameter <span class="CITchapbm">T</span> is a placeholder that must be supplied with a type argument. In Listing 12.7, you can see that the type parameter will be used for the <span class="CITchapbm">InternalItems</span> array, the type for the parameter to the <span class="CITchapbm">Push()</span> method, and the return type for the <span class="CITchapbm">Pop()</span> method.</p>















<div data-element-id="5be2bb45-d9e7-4aee-9a68-c9e05d42f757" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.7:</span>&#x2002;Declaring a Generic Class, <span class="CITchapbm">Stack&lt;T&gt;</span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public class</span> Stack&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">public</span> Stack(<span class="CPKeyword">int</span> maxSize)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            InternalItems = <span class="CPKeyword">new</span> T[maxSize];            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// Use read-only field prior to C# 6.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">private</span> T[] InternalItems { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public void</span> Push(T data)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ...            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> T Pop()            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ...            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>














<div data-element-id="fc922096-01c1-4744-8b66-ada1c6b64d69" class="element-section section-heading H2">
Benefits of Generics</div>













<p data-element-id="fa7b36f9-b418-45eb-b96d-3e58edd27e88" class="element-section paragraph HEADFIRST" >
There are several advantages of using a generic class rather than a nongeneric version (such as the <span class="CITchapbm">System.Collections.Generic.Stack&lt;T&gt;</span> class used earlier instead of the original <span class="CITchapbm">System.Collections.Stack</span> type):</p>



















<div data-element-id="1ce2fe2e-3c12-43a3-9cb7-bd84833fa830" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        1.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLFIRST">
Generics facilitate increased type safety, preventing data types other than those explicitly intended by the members within the parameterized class. In Listing 12.7, the parameterized stack class restricts you to the <span class="CITchapbm">Cell</span> data type when using <span class="CITchapbm">Stack&lt;Cell&gt;</span>. For example, the statement <span class="CITchapbm">path.Push(&quot;garbage&quot;)</span> produces a compile-time error indicating that there is no overloaded method for <span class="CITchapbm">System.Collections.Generic.Stack&lt;T&gt;.Push(T)</span> that can work with the string, because it cannot be converted to a <span class="CITchapbm">Cell</span>.
            </div>
    </div>
</div>














<div data-element-id="98cdf315-7349-4b7e-8f47-6b13fd054821" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        2.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Compile-time type checking reduces the likelihood of <span class="CITchapbm">InvalidCastException</span> type errors at runtime.
            </div>
    </div>
</div>














<div data-element-id="dcb62b51-c146-468f-bafd-93faa3c7918d" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        3.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Using value types with generic class members no longer causes a boxing conversion to <span class="CITchapbm">object</span>. For example, <span class="CITchapbm">path.Pop()</span> and <span class="CITchapbm">path.Push()</span> do not require an item to be boxed when added or unboxed when removed.
            </div>
    </div>
</div>














<div data-element-id="2b04571c-6062-4c38-8cc6-79ec919b98e0" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        4.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Generics in C# reduce code bloat. Generic types retain the benefits of specific class versions, without the overhead. For example, it is no longer necessary to define a class such as <span class="CITchapbm">CellStack</span>.
            </div>
    </div>
</div>














<div data-element-id="c277317b-38fc-406b-a742-50129e43a24a" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        5.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Performance improves because casting from an object is no longer required, thereby eliminating a type check operation. Also, performance improves because boxing is no longer necessary for value types.
            </div>
    </div>
</div>














<div data-element-id="4ae5bd86-af02-4015-88f6-c9ac609b2038" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        6.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Generics reduce memory consumption by avoiding boxing and thus consuming less memory on the heap.
            </div>
    </div>
</div>














<div data-element-id="eb4d8e8c-e8a1-4a76-a934-c7dd2b79e097" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        7.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLMID">
Code becomes more readable because of fewer casting checks and because of the need for fewer type-specific implementations.
            </div>
    </div>
</div>














<div data-element-id="45338d87-9f31-472f-93fc-00e9064b0288" class="element-section ordered-list-item">
    <div class=ordered-list-item-number>
        8.
    </div>
    <div class=ordered-list-item-content>
            <div class="ordered-list-item-paragraph NLLAST">
Editors that assist coding via some type of IntelliSense work directly with return parameters from generic classes. There is no need to cast the return data for IntelliSense to work.
            </div>
    </div>
</div>









<p data-element-id="76fe4bb3-8042-45d2-934a-7cec532ee96b" class="element-section paragraph CHAPBM" >
At their core, generics offer the ability to code pattern implementations and then reuse those implementations wherever the patterns appear. Patterns describe problems that occur repeatedly within code, and templates provide a single implementation for these repeating patterns.</p>















<div data-element-id="bf573074-0ad4-4c8f-8c56-24763667abab" class="element-section section-heading H2">
Type Parameter Naming Guidelines</div>













<p data-element-id="49ef5d09-c370-463c-a2f8-7d22023ddaaa" class="element-section paragraph HEADFIRST" >
Just as when naming a method&#x2019;s formal parameter, so you should be as descriptive as possible when naming a type parameter. Furthermore, to distinguish the parameter as being a type parameter, its name should include a <span class="ITAL">T</span> prefix. For example, in defining a class such as <span class="CITchapbm">EntityCollection&lt;TEntity&gt;</span>, you would use the type parameter name <span class="CITchapbm">TEntity</span>.</p>














<p data-element-id="6a70a46d-003f-47b1-b7a2-ad26acb6c99c" class="element-section paragraph CHAPBM" >
The only time you would not use a descriptive type parameter name is when such a description would not add any value. For example, using <span class="ITAL">T</span> in the <span class="CITchapbm">Stack&lt;T&gt;</span> class is appropriate, since the indication that <span class="ITAL">T</span> is a type parameter is sufficiently descriptive; the stack works for any type.</p>














<p data-element-id="9710ae2f-0579-42bd-a81b-e3ddd03cbd35" class="element-section paragraph CHAPBM" >
In the next section, you will learn about constraints. It is a good practice to use constraint-descriptive type names. For example, if a type parameter must implement <span class="CITchapbm">IComponent</span>, consider using a type name of <span class="CITchapbm">TComponent</span>.</p>





















<div data-element-id="ef4fbe67-334e-4c7d-84d5-21b766905363" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">DO</span> choose meaningful names for type parameters and prefix the name with <span class="ITAL">T</span>.                </div>
                <div class="guidelines-block-line">
<span class="BOLD">CONSIDER</span> indicating a constraint in the name of a type parameter.                </div>
        </div>
    </div>
</div>








<div data-element-id="55ee0f37-4602-4c81-8115-b5c61e5a6511" class="element-section section-heading H2">
Generic Interfaces and Structs</div>













<p data-element-id="52fdc2c2-ce8d-4d3f-93ee-53de766c7ec5" class="element-section paragraph HEADFIRST" >
C# supports the use of generics throughout the language, including interfaces and structs. The syntax is identical to that used by classes. To declare an interface with a type parameter, place the type parameter in angle brackets immediately after the interface name, as shown in the example of <span class="CITchapbm">IPair&lt;T&gt;</span> in Listing 12.8.</p>















<div data-element-id="319715f5-766a-4c60-8580-310bbe8df3ef" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.8:</span>&#x2002;Declaring a Generic Interface    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">interface</span> IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    T First { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    T Second { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="e5d67c8c-b439-4610-a070-7491a1b6c2df" class="element-section paragraph CHAPBMCON" >
This interface represents pairs of like objects, such as the coordinates of a point, a person&#x2019;s genetic parents, or nodes of a binary tree. The type contained in the pair is the same for both items.</p>














<p data-element-id="27a756ad-fb4e-4e9b-b4c1-93af84b92d66" class="element-section paragraph CHAPBM" >
To implement the interface, you use the same syntax as you would for a nongeneric class. Note that it is legal&#x2014;indeed, common&#x2014;for the type argument for one generic type to be a type parameter of another generic type, as shown in Listing 12.9. The type argument of the interface is the type parameter declared by the class. In addition, this example uses a struct rather than a class, demonstrating that C# supports custom generic value types.</p>















<div data-element-id="c46f777e-85cc-491c-bce9-fe7252954d8a" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.9:</span>&#x2002;Implementing a Generic Interface    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Pair&lt;T&gt;: IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> T First { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> T Second { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="7c418fea-afab-4d20-8806-189be5851f82" class="element-section paragraph CHAPBM" >
Support for generic interfaces is especially important for collection classes, where generics are most prevalent. Before generics were available in C#, developers relied on a series of interfaces within the <span class="CITchapbm">System.Collections</span> namespace. Like their implementing classes, these interfaces worked only with type <span class="CITchapbm">object</span>, and as a result, the interface forced all access to and from these collection classes to require a cast. By using type-safe generic interfaces, you can avoid cast operations.</p>


































<div data-element-id="4f84fb1f-2867-4975-a99d-99333a9f6402" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Implementing the Same Interface Multiple Times on a Single Class</div>





<p data-element-id="5833407f-8d39-4a74-98db-24d0a42988bd" class="element-section paragraph SF1FIRST" >
Two different constructions of the same generic interface are considered different types. Consequently, &#x201C;the same&#x201D; generic interface can be implemented multiple times by a class or struct. Consider the example in Listing 12.10.</p>















<div data-element-id="5b2fd9f8-4ca5-4e8e-b49a-798c7cf801b3" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.10:</span>&#x2002;Duplicating an Interface Implementation on a Single Class    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">interface</span> IContainer&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ICollection&lt;T&gt; Items  { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> Person: IContainer&lt;Address&gt;,            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    IContainer&lt;Phone&gt;, IContainer&lt;Email&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    ICollection&lt;Address&gt; IContainer&lt;Address&gt;.Items            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">get</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">set</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    ICollection&lt;Phone&gt; IContainer&lt;Phone&gt;.Items            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">get</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">set</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    ICollection&lt;Email&gt; IContainer&lt;Email&gt;.Items            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">get</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">set</span>{...}            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="7ccfab7a-e29c-412c-ab86-5a4d7ee2e8cc" class="element-section paragraph SF1MID" >
In this example, the <span class="CITchapbm">Items</span> property appears multiple times using an explicit interface implementation with a varying type parameter. Without generics, this would not be possible; instead, the compiler would allow only one explicit <span class="CITchapbm">IContainer.Items</span> property.</p>














<p data-element-id="6b8ccd16-5b9a-4af7-93f7-31ff345b4703" class="element-section paragraph SF1LAST" >
However, this technique of implementing multiple versions of the same interface is considered by many developers to be a &#x201C;bad code smell&#x201D; because it is potentially confusing (particularly if the interface permits covariant or contravariant conversions). Moreover, the <span class="CITchapbm">Person</span> class here seems potentially badly designed; one does not normally think of a person as being &#x201C;a thing that can provide a set of email addresses.&#x201D; When you feel tempted to make a class implement three versions of the same interface, consider whether it might be better to make it instead implement three properties&#x2014;for example, <span class="CITchapbm">EmailAddresses</span>, <span class="CITchapbm">PhoneNumbers</span>, and <span class="CITchapbm">MailingAddresses</span>&#x2014;each of which returns the appropriate construction of the generic interface.</p>





















<div data-element-id="ce3491b8-e081-4c0f-968c-f74982cbd114" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">AVOID</span> implementing multiple constructions of the same generic interface in one type.                </div>
        </div>
    </div>
</div>







<p data-element-id="34dfc81a-d59e-46be-afc6-cc5bbde3144e" class="element-section paragraph SF1FIRST" >
</p>










</div>








<div data-element-id="98b27706-9b6d-436d-86cc-aae790a5cb65" class="element-section section-heading H2">
Defining a Constructor and a Finalizer</div>













<p data-element-id="eac4d067-dff5-4c43-9f8d-803c115e18a6" class="element-section paragraph HEADFIRST" >
Perhaps surprisingly, the constructors (and finalizer) of a generic class or struct do not require type parameters; in other words, they do not require <span class="CITchapbm">Pair&lt;T&gt;(){...}</span>. In the pair example in Listing 12.11, the constructor is declared using <span class="CITchapbm">public Pair(T first, T second)</span>.</p>















<div data-element-id="d0c7ae44-bcfe-4c5f-8e9f-9e4b4c10ac48" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.11:</span>&#x2002;Declaring a Generic Type&#x2019;s Constructor    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Pair&lt;T&gt;: IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Pair(T first, T second)            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      First = first;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Second = second;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> T First  { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> T Second  { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>














<div data-element-id="43eb5fb5-0a04-499a-a02c-dbd8d28f4f66" class="element-section section-heading H2">
Specifying a Default Value with the <span class="CITchapbm">default</span> operator</div>













<p data-element-id="ca363bf0-0ffe-4ffe-8ae7-8402d3660694" class="element-section paragraph HEADFIRST" >
Listing 12.11 included a constructor that takes the initial values for both <span class="CITchapbm">first</span> and <span class="CITchapbm">second</span> and assigns them to <span class="CITchapbm">First</span> and <span class="CITchapbm">Second</span>. Since <span class="CITchapbm">Pair&lt;T&gt;</span> is a struct, any constructor you provide must initialize all fields and automatically implemented properties. This presents a problem, however. </p>














<p data-element-id="ca3288a2-f046-4d1e-b8f8-a5e5bdac0aeb" class="element-section paragraph CHAPBM" >
Consider a constructor for <span class="CITchapbm">Pair&lt;T&gt;</span> that initializes only half of the pair at instantiation time. Defining such a constructor, as shown in Listing 12.12, causes a compile-time error because the field <span class="CITchapbm">Second</span> is still uninitialized at the end of the constructor. Providing initialization for <span class="CITchapbm">Second</span> presents a problem because you don&#x2019;t know the data type of <span class="CITchapbm">T</span>. If it is a nullable type, <span class="CITchapbm">null</span> would work, but this approach would not work if <span class="CITchapbm">T</span> were a non-nullable type.</p>















<div data-element-id="1d3272cf-c3d0-4471-a6d7-57eb6ea0e24d" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.12:</span>&#x2002;Not Initializing All Fields, Causing a Compile-Time Error    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Pair&lt;T&gt;: IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ERROR:  Field </span><span class="Maroonital">&#x27;Pair&lt;T&gt;.Second&#x27;</span><span class="CPComment"> must be fully assigned</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  //         before control leaves the constructor</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// </span><span class="CPKeyword">public</span> Pair(T first)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// </span>{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// </span>    First = first;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// </span>}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>


























<p data-element-id="9e8ea2a5-9af2-4158-a433-dfbfe61fe9d7" class="element-section paragraph CHAPBM" >
To deal with this scenario, C# provides the <span class="CITchapbm">default</span> operator. The default value of <span class="CITchapbm">int</span>, for example, could be specified with <span class="CITchapbm">default </span>(assuming C# 7.1). In the case of <span class="CITchapbm">T</span>, which <span class="CITchapbm">Second</span> requires, you can use <span class="CITchapbm">default</span>, as shown in Listing 12.13.</p>















<div data-element-id="6389ced6-c0d2-4962-872b-7213e3199b66" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.13:</span>&#x2002;Initializing a Field with the <span class="CITchapbm">default</span> Operator    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Pair&lt;T&gt;: IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Pair(T first)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      First = first;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Second = <span class="CPKeyword">default</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="97eefa22-52cf-45c8-84f5-20fd4705b29d" class="element-section paragraph CHAPBM" >
The <span class="CITchapbm">default</span> operator can provide the default value for any type, including type parameters.</p>














<p data-element-id="af206e25-d21b-41d0-8381-85d84aa21ad3" class="element-section paragraph CHAPBM" >
Prior to C# 7.1, it was necessary to always to pass a type parameter to the <span class="CITchapbm">default</span> operator, as in <span class="CITchapbm">Second = default(T)</span>. However, C# 7.1 includes the option to use <span class="CITchapbm">default</span> without specifying a parameter if it is possible to infer the data type. For example, with variable initialization or assignment, you can use <span class="CITchapbm">Pair&lt;T&gt; pair = default</span> in place of <span class="CITchapbm">Pair&lt;T&gt; pair = default(Pair&lt;T&gt;)</span>. Furthermore, if a method returns an <span class="CITchapbm">int</span>, it is possible to simply use <span class="CITchapbm">return default</span> and have the compiler infer a <span class="CITchapbm">default(int)</span> from the return of the method. Other scenarios where such inference is possible are default parameter (optional) values and method call arguments.</p>



























<p data-element-id="41c6be37-6af3-41eb-8ee9-271425884c79" class="element-section paragraph CHAPBM" >
Note that all nullable types have <span class="CITchapbm">null</span> as their default value, as do nullable generic types such as <span class="CITchapbm">default(T?)</span>. Furthermore, the default value for all reference types is <span class="CITchapbm">null</span>. As a result, if nullable reference types are enabled with C# 8.0, assigning <span class="CITchapbm">default</span> to a non-nullable reference type will result in a warning. Unfortunately, any code that assigns <span class="CITchapbm">default</span> to a reference type in C# 7.0 or earlier thus will produce a warning when being upgraded to support nullability in C# 8.0. For this reason, prior to C# 8.0 (and obviously after it), you should avoid assigning <span class="CITchapbm">default</span> or <span class="CITchapbm">null</span> to reference types unless <span class="CITchapbm">null</span> is expected to be a valid value. Where possible, favor leaving the variable uninitialized until a valid value is available for assignment. In cases like Listing 12.13, where an appropriate value for <span class="CITchapbm">Second</span> is unknown in the constructor, <span class="CITchapbm">Second</span> will inevitably be <span class="CITchapbm">null</span> for a reference type or a nullable value type; thus, a warning appears when assigning <span class="CITchapbm">default</span> (which is potentially <span class="CITchapbm">null</span>) to a property of generic type <span class="CITchapbm">T</span>. To appropriately handle the warning, you will need to declare the <span class="CITchapbm">Second</span> property to be of type <span class="CITchapbm">T?</span> and identify whether <span class="CITchapbm">T</span> is a reference type or a value type with a class/struct constraint as described in the &#x201C;<span class="CITchapbm">struct/class</span> Constraints&#x201D; section. (In fact, this leads to the more general guideline not to assign default on a generic type unless the type assigned is constrained to a class or a struct.)</p>









































<div data-element-id="183a9590-2336-4781-b7ea-1929291a435b" class="element-section section-heading H2">
Multiple Type Parameters</div>













<p data-element-id="507fdeef-a223-4871-9c65-73d815298776" class="element-section paragraph HEADFIRST" >
Generic types may declare any number of type parameters. The initial <span class="CITchapbm">Pair&lt;T&gt;</span> example contained only one type parameter. To enable support for storing a dichotomous pair of objects, such as a name/value pair, you could create a new version of the type that declares two type parameters, as shown in Listing 12.14.</p>















<div data-element-id="bfd48093-2b95-45bf-ab21-244829f173d5" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.14:</span>&#x2002;Declaring a Generic with Multiple Type Parameters    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">interface</span> IPair&lt;TFirst, TSecond&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    TFirst First { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    TSecond Second { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Pair&lt;TFirst, TSecond&gt;: IPair&lt;TFirst, TSecond&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> Pair(TFirst first, TSecond second)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        First = first;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Second = second;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> TFirst First { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> TSecond Second { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="327e3dec-06e4-4a47-b4f9-cfa3c2328fc2" class="element-section paragraph CHAPBM" >
When you use the <span class="CITchapbm">Pair&lt;TFirst, TSecond&gt;</span> class, you supply multiple type parameters within the angle brackets of the declaration and instantiation statements; you then supply matching types to the parameters of the methods when you call them. Listing 12.15 illustrates this approach.</p>















<div data-element-id="711db33e-014a-4cf6-99fb-466c0ac89fce" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.15:&#x2002;</span>Using a Type with Multiple Type Parameters    </div>

    <div class="code-block-lines">
            <div class='code-line '>
Pair&lt;<span class="CPKeyword">int</span>, <span class="CPKeyword">string</span>&gt; historicalEvent =            </div>
            <div class='code-line '>
<span class="CPKeyword">&nbsp;&nbsp;&nbsp;&nbsp;    new</span> Pair&lt;<span class="CPKeyword">int</span>, <span class="CPKeyword">string</span>&gt;(1914,            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="Maroon">&quot;Shackleton leaves for South Pole on ship Endurance&quot;</span>);            </div>
            <div class='code-line '>
Console.WriteLine(<span class="Maroon">&quot;{0}: {1}&quot;</span>,            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    historicalEvent.First, historicalEvent.Second);            </div>
    </div>
</div>













<p data-element-id="e7797143-8222-47b1-8bff-fe74973f3106" class="element-section paragraph CHAPBM" >
The number of type parameters&#x2014;that is, the <span class="BOLD">arity</span>&#x2014;uniquely distinguishes the class from others of the same name. Because of this arity variation, it is possible to define both <span class="CITchapbm">Pair&lt;T&gt;</span> and <span class="CITchapbm">Pair&lt;TFirst, TSecond&gt;</span> within the same namespace. Furthermore, because of their close semantic relationship, generics that differ only by arity should be placed into the same C# file.</p>





















<div data-element-id="ebc42a46-e622-4e13-a514-283d53bc1e07" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">DO</span> place multiple generic semantically equivalent classes into a single file if they differ only by the number of generic parameters.                </div>
        </div>
    </div>
</div>



























<div data-element-id="5d632ee9-47ba-40e1-be9e-b2b464a12e1f" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">Beginner Topic</div>
    <div class="skill-topic-sub-heading">Tuples: An Abundance of Arity</div>





<p data-element-id="811fd6b0-3c24-4096-be7f-c806c67e7771" class="element-section paragraph SF1FIRST" >
We introduced C# 7.0&#x2019;s support for tuple syntax back in Chapter 3. Internally, the underlying type that implements the tuple syntax is, in fact, a generic&#x2014;specifically a <span class="CITchapbm">System.ValueTuple</span>. As with <span class="CITchapbm">Pair&lt;...&gt;</span>, it is possible to reuse the same name because of the variation in arity (each class has a different number of type parameters), as shown in Listing 12.16.</p>















<div data-element-id="a1ebaa2a-c68d-4bba-b188-3ebd300660ca" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.16:</span>&#x2002;Using Arity to Overload a Type Definition    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple { ... }            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1&gt;:            </div>
            <div class='code-line '>
&nbsp;&nbsp;  IStructuralEquatable, IStructuralComparable, IComparable {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3, T4&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3, T4, T5&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3, T4, T5, T6&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3, T4, T5, T6, T7&gt;: ... {...}            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ValueTuple&lt;T1, T2, T3, T4, T5, T6, T7, TRest&gt;: ... {...}            </div>
    </div>
</div>













<p data-element-id="7e16ad72-b1ac-42a2-975f-0c60e6c7e01c" class="element-section paragraph SF1MID" >
The <span class="CITchapbm">ValueTuple&lt;...&gt;</span> set of classes was designed for the same purpose as the <span class="CITchapbm">Pair&lt;T&gt;</span> and <span class="CITchapbm">Pair&lt;TFirst, TSecond&gt;</span> classes, except that together they can handle eight type arguments. In fact, using the last <span class="CITchapbm">ValueTuple</span> shown in Listing 12.16, <span class="CITchapbm">TRest</span> can be used to store another <span class="CITchapbm">ValueTuple</span>, making the number of elements of the tuple practically unlimited. And, if you define such a tuple using C# 7.0&#x2019;s tuple syntax, that is what the compiler will generate.</p>














<p data-element-id="f40cea22-3d46-4596-ac0d-92fe40078ce5" class="element-section paragraph SF1MID" >
Another interesting member of the tuple family of classes is the nongeneric <span class="CITchapbm">ValueTuple</span> class. This class has eight static factory methods for instantiating the various generic tuple types. Although each generic type could be instantiated directly using its constructor, the <span class="CITchapbm">ValueTuple</span> type&#x2019;s factory methods allow for inference of the type arguments via the <span class="CITchapbm">Create()</span> method. This is not important in C# 7.0 because the code is as simple as <span class="CITchapbm">var keyValuePair = (&quot;555-55-5555&quot;, new Contact(&quot;Inigo Montoya&quot;))</span> (assuming no named items). However, as shown in Listing 12.17, using the <span class="CITchapbm">Create()</span> method in combination with type inference is simpler for C# 6.0.</p>















<div data-element-id="9de688ca-5b14-4a3a-8528-6f128d9d7780" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.17:</span>&#x2002;Comparing <span class="CITchapbm">System.ValueTuple</span> Instantiation Approaches    </div>

    <div class="code-block-lines">
            <div class='code-line '>
#if !PRECSHARP7            </div>
            <div class='code-line '>
&nbsp;&nbsp;  (<span class="CPKeyword">string</span>, Contact) keyValuePair;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  keyValuePair =            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      (<span class="Maroon">&quot;555-55-5555&quot;</span>, <span class="CPKeyword">new</span> Contact(<span class="Maroon">&quot;Inigo Montoya&quot;</span>));            </div>
            <div class='code-line '>
#else  <span class="CPComment">// Use System.ValueTuple&lt;string,Contact&gt; prior to C# 7.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  ValueTuple&lt;<span class="CPKeyword">string</span>, Contact&gt; keyValuePair;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  keyValuePair =            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ValueTuple.Create(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="Maroon">&quot;555-55-5555&quot;</span>, <span class="CPKeyword">new</span> Contact(<span class="Maroon">&quot;Inigo Montoya&quot;</span>));            </div>
            <div class='code-line '>
&nbsp;&nbsp;  keyValuePair =            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">new</span> ValueTuple&lt;<span class="CPKeyword">string</span>, Contact&gt;(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="Maroon">&quot;555-55-5555&quot;</span>, <span class="CPKeyword">new</span> Contact(<span class="Maroon">&quot;Inigo Montoya&quot;</span>));            </div>
            <div class='code-line '>
#endif // !PRECSHARP7            </div>
    </div>
</div>













<p data-element-id="17ac9ade-12b2-4efe-893f-890d85187eb5" class="element-section paragraph SF1MID" >
Obviously, when the <span class="CITchapbm">ValueTuple</span> gets large, the number of type parameters to specify could be cumbersome without the <span class="CITchapbm">Create()</span> factory methods.</p>



























<p data-element-id="5fa12d49-f5ae-4703-807f-7c6c15c03d5a" class="element-section paragraph SF1LAST" >
Note that a similar tuple class was added in C# 4.0: <span class="CITchapbm">System.Tuple</span>. However, it was determined that abundant use of C# 7.0&#x2019;s tuple syntax and the resulting prevalence of tuples it would introduce warranted creating the <span class="CITchapbm">System.ValueTuple</span> type because of the performance improvements it provided.</p>




































</div>







<p data-element-id="7fd9a639-378e-49ad-8ecd-5526b1e4d022" class="element-section paragraph CHAPBM" >
As you might have deduced from the fact that the framework libraries declare eight different generic <span class="CITchapbm">System.ValueTuple</span> types, there is no support in the CLR type system for <span class="ITAL">variadic</span> generic types. Methods can take an arbitrary number of arguments by using <span class="ITAL">parameter arrays</span>, but there is no corresponding technique for generic types; every generic type must be of a specific arity. (See Beginner Topic: Tuples: An Abundance of Arity for an example where you might imagine such a feature.)</p>















<div data-element-id="22d01507-3f75-474f-9e08-ff2727bdd564" class="element-section section-heading H2">
Nested Generic Types</div>













<p data-element-id="67e45bfe-de6f-4801-ab15-2e67ed21340c" class="element-section paragraph HEADFIRST" >
Type parameters on a containing generic type will &#x201C;cascade&#x201D; down to any nested types automatically. If the containing type declares a type parameter <span class="CITchapbm">T</span>, for example, all nested types will also be generic, and type parameter <span class="CITchapbm">T</span> will be available on the nested type as well. If the nested type includes its own type parameter named <span class="CITchapbm">T</span>, this will hide the type parameter within the containing type, and any reference to <span class="CITchapbm">T</span> in the nested type will refer to the nested <span class="CITchapbm">T</span> type parameter. Fortunately, reuse of the same type parameter name within the nested type will cause a compiler warning to prevent accidental overlap (see Listing 12.18).</p>















<div data-element-id="0c159794-4351-4415-851e-a162a800fcfc" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.18:</span>&#x2002;Nested Generic Types    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">class</span> Container&lt;T1, T2&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // Nested classes inherit type parameters.</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // Reusing a type parameter name will cause</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // a warning.</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">class</span> Nested&lt;T2&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">void</span> Method(T1 param0, T2 param1)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="b40f5009-f19b-4793-9381-bd5955f1d9c3" class="element-section paragraph CHAPBM" >
The containing type&#x2019;s type parameters are accessible in the nested type in the same way that members of the containing type are also accessible from the nested type. The rule is simply that a type parameter is available anywhere within the body of the type that declares it.</p>





















<div data-element-id="d13534fa-30aa-4d04-bd48-70eac7ec07c3" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">AVOID</span> shadowing a type parameter of an outer type with an identically named type parameter of a nested type.                </div>
        </div>
    </div>
</div>








<div data-element-id="021e9db8-1a57-42bf-a005-2dd8f6a275c3" class="element-section section-heading H1">
Constraints</div>













<p data-element-id="83094c7c-aeea-4cd0-a993-d3ea9bb3d2c3" class="element-section paragraph HEADFIRST" >
Generics support the ability to define constraints on type parameters. These constraints ensure that the types provided as type arguments conform to various rules. Take, for example, the <span class="CITchapbm">BinaryTree&lt;T&gt;</span> class shown in Listing 12.19.</p>















<div data-element-id="87490c80-1476-4fdf-9a1d-36129912d32f" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.19:</span>&#x2002;Declaring a <span class="CITchapbm">BinaryTree&lt;T&gt;</span> Class with No Constraints    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> BinaryTree ( T item)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Item = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> T Item { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> Pair&lt;BinaryTree&lt;T&gt;&gt; SubItems { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="93b86256-e8f2-437e-8c9b-c639be602330" class="element-section paragraph CHAPBMCON" >
(An interesting side note is that <span class="CITchapbm">BinaryTree&lt;T&gt;</span> uses <span class="CITchapbm">Pair&lt;T&gt;</span> internally, which is possible because <span class="CITchapbm">Pair&lt;T&gt;</span> is simply another type.)</p>














<p data-element-id="68583889-1744-4049-aaa8-58de15f2ab77" class="element-section paragraph CHAPBM" >
Suppose you want the tree to sort the values within the <span class="CITchapbm">Pair&lt;T&gt;</span> value as it is assigned to the <span class="CITchapbm">SubItems</span> property. To achieve the sorting, the <span class="CITchapbm">SubItems</span> set accessor uses the <span class="CITchapbm">CompareTo()</span> method of the supplied key, as shown in Listing 12.20.</p>















<div data-element-id="08eda3fe-5490-4dd4-8369-e383bff14afd" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.20:</span>&#x2002;Needing the Type Parameter to Support an Interface    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> BinaryTree(T item)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Item = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> T Item { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Pair&lt;BinaryTree&lt;T&gt;&gt; SubItems            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">get</span>{ <span class="CPKeyword">return</span> _SubItems; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">set</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          IComparable&lt;T&gt; first;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPComment">// ERROR: Cannot implicitly convert type...</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          first = <span class="CPKeyword">value</span>.First;  <span class="CPComment">// Explicit cast required</span>            </div>
            <div class='code-line CDThighlight'>
            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">if</span> (first.CompareTo(<span class="CPKeyword">value</span>.Second) &lt; 0)            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// first is less than second</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// ...</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">else</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// first and second are the same or</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// second is less than first</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// ...</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          _SubItems = <span class="CPKeyword">value</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">private</span> Pair&lt;BinaryTree&lt;T&gt;&gt; _SubItems;            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="9e6d703b-c0bc-44ab-a31b-a458d516a548" class="element-section paragraph CHAPBM" >
At compile time, the type parameter <span class="CITchapbm">T</span> is an unconstrained generic. When the code is written as shown in Listing 12.20, the compiler assumes that the only members available on <span class="CITchapbm">T</span> are those inherited from the base type <span class="CITchapbm">object</span>, since every type has <span class="CITchapbm">object</span> as a base class. Only methods such as <span class="CITchapbm">ToString()</span>, therefore, are available to call on an instance of the type parameter <span class="CITchapbm">T</span>. As a result, the compiler displays a compilation error because the <span class="CITchapbm">CompareTo()</span> method is not defined on type <span class="CITchapbm">object</span>.</p>














<p data-element-id="a3fb5d14-b852-481c-be04-bf8276b1798f" class="element-section paragraph CHAPBM" >
You can cast the <span class="CITchapbm">T</span> parameter to the <span class="CITchapbm">IComparable&lt;T&gt;</span> interface to access the <span class="CITchapbm">CompareTo()</span> method, as shown in Listing 12.21.</p>















<div data-element-id="1cfed161-51f4-47c3-acca-adb828f7c6dc" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.21:</span>&#x2002;Needing the Type Parameter to Support an Interface or Exception Thrown    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> BinaryTree(T item)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Item = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> T Item { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Pair&lt;BinaryTree&lt;T&gt;?&gt;? SubItems            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">get</span>{ <span class="CPKeyword">return</span> _SubItems; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">set</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">switch</span>(<span class="CPKeyword">value</span>)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// Null handling removed for elucidation</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// Using C# 8.0 Pattern Matching. Switch to</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              // checking for null prior to C# 8.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> {             </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      First: {Item: IComparable&lt;T&gt; first },             </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Second: {Item: T second } }:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">if</span>(<span class="E4">first.CompareTo(second)</span> &lt; 0)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="CPComment">// first is less than second</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">else</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="CPComment">// second is less than or equal to first</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">default</span>:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">throw</span> <span class="CPKeyword">new</span> InvalidCastException(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="Maroon">@$&quot;Unable to sort the items.</span> {             </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                          <span class="CPKeyword">typeof</span>(T) }<span class="Maroon"> does not support IComparable&lt;T&gt;&quot;</span>);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          _SubItems = <span class="CPKeyword">value</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">private</span> Pair&lt;BinaryTree&lt;T&gt;?&gt;? _SubItems;            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="fc1abf23-c63f-4b34-a748-5c9a6aafc8b7" class="element-section paragraph CHAPBMCON" >
Unfortunately, if you now declare a <span class="CITchapbm">BinaryTree&lt;SomeType&gt;</span> class variable but the type argument (<span class="CITchapbm">SomeType</span>) does not implement the <span class="CITchapbm">IComparable&lt;SomeType&gt;</span> interface, there is no way to sort the items; in turn, we throw an <span class="CITchapbm">InvalidCastException</span>, indicating the type doesn&#x2019;t support the requisite interface. This eliminates a key reason for having generics in the first place: to improve type safety.</p>














<p data-element-id="e1af2295-1278-4204-84a1-d912c255ab1c" class="element-section paragraph CHAPBM" >
To avoid this exception and instead generate a compile-time error if the type argument does not implement the interface, C# allows you to supply an optional list of <span class="BOLD">constraints</span> for each type parameter declared in the generic type. A constraint declares the characteristics that the generic type requires of the type argument supplied for each type parameter. You declare a constraint using the <span class="CITchapbm">where</span> keyword, followed by a parameter&#x2013;requirements pair, where the parameter must be one of those declared in the generic type. The requirements describe one of three things: the class or interfaces to which the type argument must be convertible, the presence of a default constructor, or a reference/value type restriction.</p>















<div data-element-id="cefebe5b-463d-46ff-8f72-cf1a3bd1da7e" class="element-section section-heading H2">
Interface Constraints</div>













<p data-element-id="6d5e549e-19d1-45d0-8347-362a5546ba41" class="element-section paragraph HEADFIRST" >
To ensure that a binary tree has its nodes correctly ordered, you can use the <span class="CITchapbm">CompareTo()</span> method in the <span class="CITchapbm">BinaryTree</span> class. To do this most effectively, you should impose a constraint on the <span class="CITchapbm">T</span> type parameter. That is, you need the <span class="CITchapbm">T</span> type parameter to implement the <span class="CITchapbm">IComparable&lt;T&gt;</span> interface. The syntax for declaring this constraint appears in Listing 12.22.</p>















<div data-element-id="65a2b3b1-eaca-439f-a444-b717dc1f2017" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.22:</span>&#x2002;Declaring an Interface Constraint    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> T: System.IComparable&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> BinaryTree(T item)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Item = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> T Item { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Pair&lt;BinaryTree&lt;T&gt;&gt; SubItems            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">get</span>{ <span class="CPKeyword">return</span> _SubItems; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">set</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">switch</span>(<span class="CPKeyword">value</span>)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// Null handling removed for elucidation</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPComment">// Using C# 8.0 Pattern Matching. Switch to</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                  // checking for null prior to C# 8.0</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">case</span> {             </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      First: {Item: T first },             </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      Second: {Item: T second } }:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">if</span>(<span class="E4">first.CompareTo(second)</span> &lt; 0)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="CPComment">// first is less than second</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">else</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="CPComment">// second is less than or equal to first</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">break</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">default</span>:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  <span class="CPKeyword">throw</span> <span class="CPKeyword">new</span> InvalidCastException(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      <span class="Maroon">@$&quot;Unable to sort the items.</span> {             </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                          <span class="CPKeyword">typeof</span>(T) }<span class="Maroon"> does not support IComparable&lt;T&gt;&quot;</span>);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          _SubItems = <span class="CPKeyword">value</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">private</span> Pair&lt;BinaryTree&lt;T&gt;?&gt;? _SubItems;            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="9a2a92da-fb0b-49c4-b2cf-c0c565e22391" class="element-section paragraph CHAPBM" >
While the code change in this example is minor, it moves the error identification to the compiler rather than at runtime, and this is an important difference. When given the interface constraint addition in Listing 12.22, the compiler ensures that each time you use the <span class="CITchapbm">BinaryTree&lt;T&gt;</span> class, you specify a type parameter that implements the corresponding construction of the <span class="CITchapbm">IComparable&lt;T&gt;</span> interface. Furthermore, you no longer need to explicitly cast the variable to an <span class="CITchapbm">IComparable&lt;T&gt;</span> interface before calling the <span class="CITchapbm">CompareTo()</span> method. Casting is not even required to access members that use explicit interface implementation, which in other contexts would hide the member without a cast. When calling a method on a value typed as a generic type parameter, the compiler checks whether the method matches any method on any of the interfaces declared as constraints.</p>














<p data-element-id="93ab7a8e-420a-4de6-b344-2bcbbe2f3a45" class="element-section paragraph CHAPBM" >
If you tried to create a <span class="CITchapbm">BinaryTree&lt;T&gt;</span> variable using <span class="CITchapbm">System.Text.StringBuilder</span> as the type parameter, you would receive a compiler error because <span class="CITchapbm">StringBuilder</span> does not implement <span class="CITchapbm">IComparable&lt;StringBuilder&gt;</span>. The error is similar to the one shown in Output 12.3.</p>
















<div data-element-id="3bdb7efa-be37-4d83-a810-dce0cb53d2d8" class="element-section output-block-section output-block-top-section output-block-bottom-section">

    <div class="output-block-heading">
Output 12.3    </div>

    <div class="output-block-lines">
            <div class="output-line">
error CS0311: The type &#x27;System.Text.StringBuilder&#x27; cannot be used as type            </div>
            <div class="output-line">
parameter &#x27;T&#x27; in the generic type or method &#x27;BinaryTree&lt;T&gt;&#x27;. There is no            </div>
            <div class="output-line">
implicit reference conversion from &#x27;System.Text.StringBuilder&#x27; to            </div>
            <div class="output-line">
&#x27;System.IComparable&lt;System.Text.StringBuilder&gt;&#x27;.            </div>
    </div>
</div>












<p data-element-id="e9de1cda-f08b-4b65-a2c6-8984f2b4e4ae" class="element-section paragraph CHAPBM" >
To specify an interface for the constraint, you declare an <span class="BOLD">interface type constraint</span>. This constraint even circumvents the need to cast to call an explicit interface member implementation.</p>















<div data-element-id="773f3272-7334-45a3-80d6-4cce190f88d1" class="element-section section-heading H2">
Type Parameter Constraints</div>













<p data-element-id="e24b8cd0-29fc-43f0-9f28-2dd370032653" class="element-section paragraph HEADFIRST" >
Sometimes you might want to constrain a type argument to be convertible to a particular type. You do this using a <span class="BOLD"> type parameter constraint</span>, as shown in Listing 12.23.</p>















<div data-element-id="96ffaa22-28d5-4fba-a014-faf7f728aa16" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.23:</span>&#x2002;Declaring a Class Type Constraint    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityDictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    : System.Collections.Generic.Dictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TKey: <span class="CPKeyword">notnull</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TValue : EntityBase            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="8e02aa3b-473a-4ec5-b01c-92d333538565" class="element-section paragraph CHAPBM" >
In Listing 12.23, <span class="CITchapbm">EntityDictionary&lt;TKey, TValue&gt;</span> requires that all type arguments provided for the type parameter <span class="CITchapbm">TValue</span> be implicitly convertible to the <span class="CITchapbm">EntityBase</span> class. By requiring the conversion, it becomes possible to use the members of <span class="CITchapbm">EntityBase</span> on values of type <span class="CITchapbm">TValue</span> within the generic implementation, because the constraint will ensure that all type arguments can be implicitly converted to the <span class="CITchapbm">EntityBase</span> class.</p>














<p data-element-id="397d317a-eab5-4f42-8884-3e1c0dc47740" class="element-section paragraph CHAPBM" >
The syntax for the class type constraint is the same as that for the interface type constraint, except that class type constraints must appear before any interface type constraints (just as the base class must appear before implemented interfaces in a class declaration). However, unlike interface constraints, multiple base class constraints are not allowed, since it is not possible to derive from multiple unrelated classes. Similarly, base class constraints cannot specify sealed classes or non-class types. For example, C# does not allow a type parameter to be constrained to <span class="CITchapbm">string</span> or <span class="CITchapbm">System.Nullable&lt;T&gt;</span> because there would then be only one possible type argument for that type parameter&#x2014;that&#x2019;s hardly &#x201C;generic.&#x201D; If the type parameter is constrained to a single type, there is no need for the type parameter in the first place; just use that type directly.</p>














<p data-element-id="c892d3a5-6ed6-4afb-88b0-b9c8aec0ee46" class="element-section paragraph CHAPBM" >
Certain &#x201C;special&#x201D; types are not legal as class type constraints. See Advanced Topic: Constraint Limitations, later in this chapter, for details.</p>



























<p data-element-id="526910b9-e205-4385-9515-feedfeddf520" class="element-section paragraph CHAPBM" >
Starting with C# 7.3, you can use <span class="CITchapbm">System.Enum</span> as a constraint, thereby ensuring a type parameter is an enum. However, you cannot specify type <span class="CITchapbm">System.Array</span> as a constraint. The latter restriction has minimal impact, however, as other collection types and interfaces are preferable anyway; see Chapter 15.</p>





















<div data-element-id="482e2248-fa42-47d8-8ae5-287e63010176" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Delegate Constraints</div>





<p data-element-id="f093e4ab-a241-4251-b328-76d727555c45" class="element-section paragraph SF1FIRST" >
C# 7.3 also added support for using <span class="CITchapbm">System.Delegate</span> (and <span class="CITchapbm">System.MulticastDelegate</span>). This allows for combining (using the static <span class="CITchapbm">Combine()</span> method) and separating (using the static <span class="CITchapbm">Remove()</span> method) delegates in a type-safe manner. There isn&#x2019;t a strongly typed way for a generic type to invoke a delegate, but the <span class="CITchapbm">DynamicInvoke()</span> method can accomplish this. Internally, it uses reflection. Even though the generic type can&#x2019;t invoke the delegate directly (without going through <span class="CITchapbm">DynamicInvoke()</span>), it is possible via a direct reference to <span class="CITchapbm">T</span> at compile time. For example, you could invoke a <span class="CITchapbm">Combine()</span> method and cast to the expected type, as shown with the pattern matching in Listing 12.24.</p>















<div data-element-id="5b3afba2-97cd-4cda-9988-3b6541b88172" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.24:</span>&#x2002;Declaring a Generic with a <span class="CITchapbm">MulticastDelegate</span> Constraint    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">static</span> <span class="CPKeyword">public</span> <span class="CPKeyword">object</span>? InvokeAll&lt;TDelegate&gt;(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">object</span>?[]? args, <span class="CPKeyword">params</span> TDelegate[] delegates)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// Constraint of type Action/Func not allowed</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TDelegate : System.MulticastDelegate            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">switch</span> (Delegate.Combine(delegates))            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">case</span> Action action:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          action();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">return</span> <span class="CPKeyword">null</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">case</span> TDelegate result:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">return</span> result.DynamicInvoke(args);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">default</span>:            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">return</span> <span class="CPKeyword">null</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  };            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="b2d9af95-b986-4ef9-a0fb-9dc21484a0a2" class="element-section paragraph SF1MID" >
In this example, we attempt to cast to <span class="CITchapbm">Action</span> before invoking the result. If that effort is not successful, we cast to <span class="CITchapbm">TDelegate</span> and invoke the result using <span class="CITchapbm">DynamicInvoke()</span>. </p>














<p data-element-id="eb5a04ee-7ba9-4fc9-bb2c-e9da3e90db71" class="element-section paragraph SF1MID" >
Note that outside the generic we would know the type of <span class="CITchapbm">T</span>, so we could invoke it directly after calling <span class="CITchapbm">Combine()</span>:</p>














<p data-element-id="f8b14ef0-89ef-4991-937a-d126b5716096" class="element-section paragraph SF1LAST" >
Note the comment in Listing 12.24. While <span class="CITchapbm">System.Delegate</span> and <span class="CITchapbm">System.MulticastDelegate</span> are supported, you cannot specify a specific delegate type such as <span class="CITchapbm">Action</span>, <span class="CITchapbm">Func&lt;T&gt;</span>, or one of the related types.</p>










</div>








<div data-element-id="aaed15db-013d-431b-87fc-037909b73a08" class="element-section section-heading H2">
<span class="CITchapbm">unmanaged</span> Constraint</div>













<p data-element-id="5ce843da-e7fc-4cd6-92da-ba402bb5401c" class="element-section paragraph HEADFIRST" >
C# 7.3 introduced the <span class="CITchapbm">unmanaged</span> constraint, which limits the type parameter to be of type <span class="CITchapbm">sbyte</span>, <span class="CITchapbm">byte</span>, <span class="CITchapbm">short</span>, <span class="CITchapbm">ushort</span>, <span class="CITchapbm">int</span>, uint, <span class="CITchapbm">long</span>, <span class="CITchapbm">ulong</span>, <span class="CITchapbm">char</span>, <span class="CITchapbm">float</span>, <span class="CITchapbm">double</span>, <span class="CITchapbm">decimal</span>, <span class="CITchapbm">bool</span>, an enum, a pointer, or any struct where all fields are unmanaged. This allows you to do things like use the <span class="CITchapbm">sizeof</span> (or <span class="CITchapbm">stackalloc</span>, as discussed in Chapter 22) operator on an unmanaged constrained type parameter.</p>



























<p data-element-id="5c50dfe1-1c64-44d6-8dbd-cd9ba21c0ee7" class="element-section paragraph CHAPBM" >
Prior to C# 8.0, the <span class="CITchapbm">unmanaged</span> constraint restricted type parameters to <span class="BOLD">constructed struct types</span>&#x2014;that is, value types that were not generic. However, C# 8.0 removed this constraint. You can now declare a variable of type <span class="CITchapbm">Thing&lt;Thing&lt;int&gt;&gt;</span> even if <span class="CITchapbm">Thing&lt;T&gt;</span> had an <span class="CITchapbm">unmanaged</span> constraint for <span class="CITchapbm">T</span>.</p>




























<div data-element-id="16e90e56-ee67-47bb-85f8-9566de74eb6e" class="element-section section-heading H2">
<span class="CITchapbm">notnull</span> Constraint</div>













<p data-element-id="3b17090e-d7eb-46a6-a63e-02560b801474" class="element-section paragraph HEADFIRST" >
In Listing 12.23, there is a second constraint: the non-<span class="CITchapbm">null</span> constraint using the contextual keyword <span class="CITchapbm">notnull</span>. This constraint triggers a warning if a nullable type is specified for the type parameter decorated with <span class="CITchapbm">notnull</span>. In this case, for example, declaring<span class="CITchapbm"> EntityDictionary&lt;string?, EntityBase&gt;</span> will lead to the following warning: <span class="CITchapbm">Nullability of type argument &#x27;string?&#x27; doesn&#x27;t match &#x27;notnull&#x27; constraint</span>.</p>














<p data-element-id="5ecfd611-6178-4fb2-a64f-062bb0bf0379" class="element-section paragraph CHAPBM" >
The <span class="CITchapbm">notnull</span> keyword cannot be combined with the <span class="CITchapbm">struct</span> or <span class="CITchapbm">class</span> constraints, which are not nullable by default (as we describe next).</p>















<div data-element-id="3db95d79-087e-413c-a0f1-5aa0303e50b3" class="element-section section-heading H2">
<span class="CITchapbm">struct/class</span> Constraints</div>













<p data-element-id="ddd706bc-c87e-4906-bc27-c7cf28500bb1" class="element-section paragraph HEADFIRST" >
Another valuable generic constraint is the ability to restrict type arguments to be any non-nullable value type or any reference type. Rather than specifying a class from which <span class="CITchapbm">T</span> must derive, you simply use the keyword <span class="CITchapbm">struct</span> or <span class="CITchapbm">class</span>, as shown in Listing 12.25.</p>















<div data-element-id="f5517ceb-325c-4a30-8d5f-a9952a3f4346" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.25:</span>&#x2002;Specifying the Type Parameter as a Value Type    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">struct</span> Nullable&lt;T&gt; :            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     IFormattable, IComparable,            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     IComparable&lt;Nullable&lt;T&gt;&gt;, INullable            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     <span class="CPKeyword">where</span> T : <span class="CPKeyword">struct</span>            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">static</span> <span class="CPKeyword">implicit</span> <span class="CPKeyword">operator</span> T?(T value) =&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">new</span> T?(value);            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">static</span> <span class="CPKeyword">explicit</span> <span class="CPKeyword">operator</span> T(T? value) =&gt; value!.Value;            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="1188d9af-c0fe-4702-8ec1-4598f7d54eed" class="element-section paragraph CHAPBM" >
Note that the <span class="CITchapbm">class</span> constraint restricts the type parameter to reference types including interface, delegate, or array types (and not, as the keyword might seem to imply, only class types).</p>














<p data-element-id="d25c47f2-fe92-47ce-8026-904543654fba" class="element-section paragraph CHAPBM" >
In C# 8.0, a <span class="CITchapbm">class</span> constraint defaults to not nullable (assuming, of course, that nullable reference types are enabled). Specifying a nullable reference type parameter will trigger a warning by the compiler. You can change the generic type to allow nullable reference types by including the nullable modifier on the <span class="CITchapbm">class</span> constraint. Consider the <span class="CITchapbm">WeakReference&lt;T&gt;</span> class introduced in Chapter 10. Since only reference types are garbage collected, this type includes the <span class="CITchapbm">class</span> constraint as follows:</p>














<p data-element-id="95fadf62-f824-4998-b207-ab0aef0fe4c2" class="element-section paragraph DPGMFIRST" >
public sealed partial class WeakReference&lt;T&gt; : ISerializable</p>














<p data-element-id="5e241886-1809-48e9-9540-b75d57cddcf9" class="element-section paragraph DPGMMID" >
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        where T : class? </p>














<p data-element-id="ab4cfcb1-9ad5-4ecb-810f-a0b8f164c5de" class="element-section paragraph DPGMLAST" >
{ ... }</p>














<p data-element-id="f5fe022b-76dc-45ce-9759-2df12b1226de" class="element-section paragraph CHAPBMCON" >
This restricts the type parameter, <span class="CITchapbm">T</span>, to be a reference type&#x2014;which may be nullable.</p>














<p data-element-id="9c55593a-fec5-464c-8123-11aa48b3c601" class="element-section paragraph CHAPBM" >
In contrast to the <span class="CITchapbm">class</span> constraint, the <span class="CITchapbm">struct</span> constraint does not allow the nullable modifier. Instead, you can specify nullability when using the parameter. In Listing 12.25, for example, the implicit and explicit conversion operators, for example, use <span class="CITchapbm">T</span> and <span class="CITchapbm">T?</span> to identify whether a non-nullable or nullable version of <span class="CITchapbm">T</span> is allowed. As such, the type parameter is constrained when it is used in member declarations, rather than with a type constraint.</p>














<p data-element-id="7de430a1-2f5c-4203-83ce-a1959f74081b" class="element-section paragraph CHAPBM" >
Because a class type constraint requires a reference type, using a <span class="CITchapbm">struct</span> constraint with a class type constraint would be contradictory. Therefore, you cannot combine <span class="CITchapbm">struct</span> and <span class="CITchapbm">class</span> constraints.</p>














<p data-element-id="11171ccf-f04a-4ef4-bd12-342f937987dd" class="element-section paragraph CHAPBM" >
The <span class="CITchapbm">struct</span> constraint has one special characteristic: Nullable value types do not satisfy the constraint. Why? Nullable value types are implemented as the generic type <span class="CITchapbm">Nullable&lt;T&gt;</span>, which itself applies the <span class="CITchapbm">struct</span> constraint to T. If nullable value types satisfied that constraint, it would be possible to define the nonsense type <span class="CITchapbm">Nullable&lt;Nullable&lt;int&gt;&gt;</span>. A doubly nullable integer is confusing to the point of being meaningless. (As expected, the shorthand syntax <span class="CITchapbm">int??</span> is also disallowed.)</p>




























<div data-element-id="5df3f5e1-2cd4-4ec4-abc9-58da3ec5c18f" class="element-section section-heading H2">
Multiple Constraints</div>













<p data-element-id="5ed4607a-0f97-4648-8f20-24b10e1a9594" class="element-section paragraph HEADFIRST" >
For any given type parameter, you may specify any number of interface type constraints, but no more than one class type constraint (just as a class may implement any number of interfaces but inherit from only one other class). Each new constraint is declared in a comma-delimited list following the generic type parameter and a colon. If there is more than one type parameter, each must be preceded by the <span class="CITchapbm">where</span> keyword. In Listing 12.26, the generic <span class="CITchapbm">EntityDictionary</span> class declares two type parameters: <span class="CITchapbm">TKey</span> and <span class="CITchapbm">TValue</span>. The <span class="CITchapbm">TKey</span> type parameter has two interface type constraints, and the <span class="CITchapbm">TValue</span> type parameter has one class type constraint.</p>















<div data-element-id="745ca7fb-3e82-40a1-8d42-1838434eb546" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.26:</span>&#x2002;Specifying Multiple Constraints    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityDictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    : Dictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TKey : IComparable&lt;TKey&gt;, IFormattable            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TValue : EntityBase            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="6b300898-09a5-44de-8c01-ddb56fc3caec" class="element-section paragraph CHAPBMCON" >
In this case, there are multiple constraints on <span class="CITchapbm">TKey</span> itself and an additional constraint on <span class="CITchapbm">TValue</span>. When specifying multiple constraints on one type parameter, an AND relationship is assumed. If a type <span class="CITchapbm">C</span> is supplied as the type argument for <span class="CITchapbm">TKey</span>, <span class="CITchapbm">C</span> must implement <span class="CITchapbm">IComparable&lt;C&gt;</span> and <span class="CITchapbm">IFormattable</span>, for example.</p>














<p data-element-id="341bf98e-fd85-44f9-a1a6-76e484ddde39" class="element-section paragraph CHAPBM" >
Notice there is no comma between each <span class="CITchapbm">where</span> clause.</p>















<div data-element-id="053eac70-8395-4784-9640-106e3bfe2369" class="element-section section-heading H2">
Constructor Constraints</div>













<p data-element-id="d2aa0752-ef73-4875-bcf7-fc3704df77b2" class="element-section paragraph HEADFIRST" >
In some cases, it is desirable to create an instance of the type argument&#x2019;s type inside the generic class. In Listing 12.27, for example, the <span class="CITchapbm">MakeValue()</span> method for the <span class="CITchapbm">EntityDictionary&lt;TKey, TValue&gt;</span> class must create an instance of the type argument corresponding to type parameter <span class="CITchapbm">TValue</span>.</p>















<div data-element-id="2f1eca55-e0ec-4e35-8958-0e2fd9e927fa" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.27:</span>&#x2002;Requiring a Default Constructor Constraint    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityBase&lt;TKey&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TKey: <span class="CPKeyword">notnull</span>            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">public</span> EntityBase(TKey key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Key = key;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> TKey Key { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityDictionary&lt;TKey, TValue&gt; :            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    Dictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TKey: IComparable&lt;TKey&gt;, IFormattable            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> TValue : EntityBase&lt;TKey&gt;, <span class="CPKeyword">new</span>()            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> TValue MakeValue(TKey key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TValue newEntity = <span class="CPKeyword">new</span> TValue            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Key = key;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Add(newEntity.Key, newEntity);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">return</span> newEntity;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="ed65cd45-2498-4f8a-99e5-42b14c6dab27" class="element-section paragraph CHAPBM" >
Because not all objects are guaranteed to have public default constructors, the compiler does not allow you to call the default constructor on an unconstrained type parameter. To override this compiler restriction, you can add the text <span class="CITchapbm">new()</span> after all other constraints are specified. This text, called a <span class="BOLD">constructor constraint</span>, requires the type argument corresponding to the constrained type parameter to have a public or internal default constructor. Only the default constructor constraint is available. You cannot specify a constraint that ensures that the type argument supplied provides a constructor that takes formal parameters.</p>














<p data-element-id="e914743f-42ac-4c9e-b4fc-6e3bf67f55b9" class="element-section paragraph CHAPBM" >
Listing 12.27 includes a constructor constraint that forces the type argument supplied for <span class="CITchapbm">TValue</span> to provide a public parameterless constructor. There is no constraint to force the type argument to provide a constructor that takes other formal parameters. For example, you might want to constrain <span class="CITchapbm">TValue</span> so that the type argument provided for it must provide a constructor that takes the type argument provided for <span class="CITchapbm">TKey</span>, but this is not possible. Listing 12.28 demonstrates the invalid code.</p>















<div data-element-id="921e9d53-8423-4034-a4df-a324975eee91" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.28:</span>&#x2002;Constructor Constraints Can Be Specified Only for Default Constructors    </div>

    <div class="code-block-lines">
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> TValue New(TKey key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// Error: &#x27;TValue&#x27;: Cannot provide arguments</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// when creating an instance of a variable type</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TValue newEntity = <span class="CPKeyword">null</span>;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// </span>newEntity = <span class="CPKeyword">new</span> TValue(key);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Add(newEntity.Key, newEntity);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">return</span> newEntity;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
    </div>
</div>













<p data-element-id="b901e9c5-c8c1-4599-996d-af78b02fb342" class="element-section paragraph CHAPBM" >
One way to circumvent this restriction is to supply a factory interface that includes a method for instantiating the type. The factory implementing the interface takes responsibility for instantiating the entity rather than the <span class="CITchapbm">EntityDictionary</span> itself (see Listing 12.29).</p>















<div data-element-id="3b5795c2-6318-42e8-94ef-877612150752" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.29:</span>&#x2002;Using a Factory Interface in Place of a Constructor Constraint    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityBase&lt;TKey&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> EntityBase(TKey key)            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  {            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Key = key;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> TKey Key { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> EntityDictionary&lt;TKey, TValue, TFactory&gt; :            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Dictionary&lt;TKey, TValue&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">where</span> TKey : IComparable&lt;TKey&gt;, IFormattable            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  <span class="CPKeyword">where</span> TValue : EntityBase&lt;TKey&gt;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  <span class="CPKeyword">where</span> TFactory : IEntityFactory&lt;TKey, TValue&gt;, <span class="CPKeyword">new</span>()            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  ...            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> TValue New(TKey key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      TFactory factory = new TFactory();            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      TValue newEntity = factory.CreateNew(key);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Add(newEntity.Key, newEntity);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">return</span> newEntity;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  ...            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line CDThighlight'>
<span class="CPKeyword">public</span> <span class="CPKeyword">interface</span> IEntityFactory&lt;TKey, TValue&gt;            </div>
            <div class='code-line CDThighlight'>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    TValue CreateNew(TKey key);            </div>
            <div class='code-line CDThighlight'>
}            </div>
            <div class='code-line '>
...            </div>
    </div>
</div>













<p data-element-id="057929df-285c-43cf-bc97-31ffda80a785" class="element-section paragraph CHAPBM" >
A declaration such as this allows you to pass the new <span class="CITchapbm">key</span> to a <span class="CITchapbm">TValue</span> factory method that takes parameters, rather than forcing you to rely on the default constructor. It no longer uses the constructor constraint on <span class="CITchapbm">TValue</span> because <span class="CITchapbm">TFactory</span> is responsible for instantiating value. (One modification to the code in Listing 12.29 would be to cache a reference to the factory method&#x2014;possibly leveraging <span class="CITchapbm">Lazy&lt;T&gt;</span> if multithreaded support was needed. This would enable you to reuse the factory method instead of reinstantiating it every time.)</p>














<p data-element-id="899c9fb4-cefd-4325-b9d2-21dae778e55c" class="element-section paragraph CHAPBM" >
A declaration for a variable of type <span class="CITchapbm">EntityDictionary&lt;TKey, TValue, TFactory&gt;</span> would result in an entity declaration similar to the <span class="CITchapbm">Order</span> entity in Listing 12.30.</p>















<div data-element-id="52d3c532-ed69-4851-b490-4a1ff06a14e5" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.30:</span>&#x2002;Declaring an Entity to Be Used in <span class="CITchapbm">EntityDictionary&lt;...&gt;</span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> Order : EntityBase&lt;Guid&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Order(Guid key) :            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">base</span>(key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> OrderFactory : IEntityFactory&lt;Guid, Order&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> Order CreateNew(Guid key)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">return</span> <span class="CPKeyword">new</span> Order(key);            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>














<div data-element-id="354e3a8c-7aba-4ab0-902e-3c0d2ffec444" class="element-section section-heading H2">
Constraint Inheritance</div>













<p data-element-id="741b0062-a892-4c90-a2e3-187afca0e65e" class="element-section paragraph HEADFIRST" >
Neither generic type parameters nor their constraints are inherited by a derived class, because generic type parameters are not members. (Remember, class inheritance is the property that the derived class has all the members of the base class.) It is a common practice to make new generic types that inherit from other generic types. In such a case, because the type parameters of the derived generic type become the type arguments of the generic base class, the type parameters must have constraints equal to (or stronger than) those on the base class. Confused? Consider Listing 12.31.</p>















<div data-element-id="9fba664e-f829-4e55-b215-e97cc8d397ee" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.31:</span>&#x2002;Inherited Constraints Specified Explicitly    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">class</span> EntityBase&lt;T&gt; <span class="CPKeyword">where</span> T : IComparable&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPComment">// ERROR:</span>            </div>
            <div class='code-line '>
<span class="CPComment">// The type </span><span class="Maroonital">&#x27;U&#x27;</span><span class="CPComment"> must be convertible to</span>            </div>
            <div class='code-line '>
<span class="CPComment">// </span><span class="Maroonital">&#x27;System.IComparable&lt;U&gt;&#x27;</span><span class="CPComment"> to use it as parameter</span>            </div>
            <div class='code-line '>
<span class="CPComment">// </span><span class="Maroonital">&#x27;T&#x27;</span><span class="CPComment"> in the generic type or method</span>            </div>
            <div class='code-line '>
<span class="CPComment">// </span><span class="CPKeyword">class</span> Entity&lt;U&gt; : EntityBase&lt;U&gt;            </div>
            <div class='code-line '>
<span class="CPComment">// </span>{            </div>
            <div class='code-line '>
<span class="CPComment">//     ...</span>            </div>
            <div class='code-line '>
<span class="CPComment">// </span>}            </div>
    </div>
</div>













<p data-element-id="c5fc2886-4416-4dec-9890-c8431c89e9df" class="element-section paragraph CHAPBM" >
In Listing 12.31, <span class="CITchapbm">EntityBase&lt;T&gt;</span> requires that the type argument <span class="CITchapbm">U</span> supplied for <span class="CITchapbm">T</span> by the base class specifier <span class="CITchapbm">EntityBase&lt;U&gt;</span> implement <span class="CITchapbm">IComparable&lt;U&gt;</span>. Therefore, the <span class="CITchapbm">Entity&lt;U&gt;</span> class needs to require the same constraint on <span class="CITchapbm">U</span>. Failure to do so will result in a compile-time error. This pattern increases a programmer&#x2019;s awareness of the base class&#x2019;s type constraint in the derived class, avoiding the confusion that might otherwise occur if the programmer uses the derived class and discovers the constraint but does not understand where it comes from.</p>














<p data-element-id="550575f2-76c0-4112-a512-da79f52be73f" class="element-section paragraph CHAPBM" >
We have not covered generic methods yet; we&#x2019;ll get to them later in this chapter. For now, simply recognize that methods may also be generic and may also place constraints on the type arguments supplied for their type parameters. How, then, are constraints handled when a virtual generic method is inherited and overridden? In contrast to the situation with type parameters declared on a generic class, constraints on overriding virtual generic methods (or explicit interface) methods are inherited implicitly and may not be restated (see Listing 12.32).</p>















<div data-element-id="b6e54da7-ab9e-496e-8412-9e672dc3915b" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.32:</span>&#x2002;Repeating Inherited Constraints on Virtual Members Is Prohibited    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">class</span> EntityBase            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">virtual</span> <span class="CPKeyword">void</span> Method&lt;T&gt;(T t)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">where</span> T : IComparable&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Order : EntityBase            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">override</span> <span class="CPKeyword">void</span> Method&lt;T&gt;(T t)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">//    Constraints may not be repeated on overriding</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  //    members</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPComment">//    </span><span class="CPKeyword">where</span> T : IComparable&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="acb8114b-f866-4229-8bfc-2ac734fc5681" class="element-section paragraph CHAPBM" >
In the generic class inheritance case, the type parameter on the derived class can be further constrained by adding not only the constraints on the base class (required), but also other constraints. However, overriding virtual generic methods need to conform exactly to the constraints defined by the base class method. Additional constraints could break polymorphism, so they are not allowed and the type parameter constraints on the overriding method are implied.</p>





















<div data-element-id="b22f76c5-fcf4-4ee1-b5b6-7b1259808eb6" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Constraint Limitations</div>





<p data-element-id="784f09d9-e5d9-4953-b3e8-8e96dab30203" class="element-section paragraph SF1FIRST" >
Constraints are appropriately limited to avoid nonsensical code. For example, you cannot combine a class type constraint with a <span class="CITchapbm">struct</span> or <span class="CITchapbm">class</span> constraint, or <span class="CITchapbm">notnull</span> with either type of constraint. Also, you cannot specify constraints that restrict inheritance to special types such as <span class="CITchapbm">object</span>, arrays, or <span class="CITchapbm">System.ValueType</span>. As mentioned earlier, <span class="CITchapbm">System.Enum</span> (<span class="CITchapbm">enum</span>), <span class="CITchapbm">System.Delegate</span>, and <span class="CITchapbm">System.MulticastDelegate</span> are supported starting in C# 7.3. However, you cannot have a constraint for a specific delegate type like <span class="CITchapbm">Action</span>, <span class="CITchapbm">Func&lt;T&gt;</span>, or related types.</p>














<p data-element-id="34ca7981-5d5b-4827-9a55-82433c5b2145" class="element-section paragraph SF1MID" >
In some cases, constraint limitations are perhaps more desirable, yet they are still not supported. Only having the ability to require a default constructor is perhaps one such limitation. The following subsections provide some additional examples of constraints that are not allowed.</p>














<p data-element-id="ea1ee535-a13d-4879-93cb-0dedc351705e" class="element-section paragraph SF1FIRST" >
All generics implicitly allow for <span class="CITchapbm">==</span> and <span class="CITchapbm">!=</span> comparisons, along with implicit casts to <span class="CITchapbm">object</span>, since everything is an object. You cannot constrain a type parameter to a type that implements a particular method or operator (other than in the aforementioned cases), except via interface type constraints (for methods) or class type constraints (for methods and operators). Because of this, the generic <span class="CITchapbm">Add()</span> in Listing 12.33 does not work.</p>















<div data-element-id="8a9dcfed-bf06-4e18-8bca-426d0823dbbe" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.33:</span>&#x2002;Constraint Expressions Cannot Require Operators    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public abstract class</span> MathEx&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPKeyword">&nbsp;&nbsp;&nbsp;&nbsp;    public</span> <span class="CPKeyword">static</span> T Add(T first, T second)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// Error: Operator &#x27;&#x2B;&#x27; cannot be applied to</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// operands of type &#x27;T&#x27; and &#x27;T&#x27;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPComment">// </span><span class="CPKeyword">return</span> <span class="E4">first &#x2B; second</span>;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="fe5666bb-210d-4544-9695-16fc626301f3" class="element-section paragraph SF1MID" >
In this case, the method assumes that the <span class="CITchapbm">&#x2B;</span> operator is available on all types that could be supplied as type arguments for <span class="CITchapbm">T</span>. But there is no constraint that prevents you from supplying a type argument that does not have an associated addition operator, so an error occurs. Unfortunately, there is no way to specify that an addition operator is required within a constraint, aside from using a class type constraint where the class type implements an addition operator.</p>














<p data-element-id="c726ace4-8807-42be-a885-25aeacc98fed" class="element-section paragraph SF1MID" >
More generally, there is no way to constrain a type to have a static method.</p>














<p data-element-id="f2b2a862-8e2f-4505-a6a5-7abd4efd0c8a" class="element-section paragraph SF1FIRST" >
If you supply multiple interfaces or class constraints for a type parameter, the compiler always assumes an AND relationship between constraints. For example, <span class="CITchapbm">where T : IComparable&lt;T&gt;</span>, <span class="CITchapbm">IFormattable</span> requires that both <span class="CITchapbm">IComparable&lt;T&gt;</span> and <span class="CITchapbm">IFormattable</span> are supported. There is no way to specify an OR relationship between constraints. Hence, code equivalent to Listing 12.34 is not supported.</p>















<div data-element-id="179c5869-f5bd-4ede-af09-b2ed8f794a1f" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.34:</span>&#x2002;Combining Constraints Using an OR Relationship Is Not Allowed    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// Error: OR is not supported</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// </span><span class="CPKeyword">where</span> T: System.IComparable&lt;T&gt; || System.IFormattable            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="6057610e-f0d7-4715-905f-c13362265f66" class="element-section paragraph SF1LAST" >
Supporting this functionality would prevent the compiler from resolving which method to call at compile time.</p>










</div>





















<div data-element-id="31191397-878c-4811-b5d9-ce8fe888a2dc" class="element-section section-heading H1">
Generic Methods</div>













<p data-element-id="ce8b6007-6f9c-46ad-9c10-f8966f9b1203" class="element-section paragraph HEADFIRST" >
Earlier, you saw that it is a relatively simple matter to add a method to a type when the type is generic; such a method can use the generic type parameters declared by the type. You did this, for example, in the generic class examples we have seen so far.</p>














<p data-element-id="c9063137-3304-4fc5-ad5e-6a05d3f859b2" class="element-section paragraph CHAPBM" >
Generic methods use generic type parameters, much as generic types do. They can be declared in generic or nongeneric types. If declared in a generic type, their type parameters are distinct from those of their containing generic type. To declare a generic method, you specify the generic type parameters the same way you do for generic types: Add the type parameter declaration syntax immediately following the method name, as shown in the <span class="CITchapbm">MathEx.Max&lt;T&gt;</span> and <span class="CITchapbm">MathEx.Min&lt;T&gt;</span> examples in Listing 12.35.</p>















<div data-element-id="aa3d36b8-4d8c-49a9-88ec-43da078a30bd" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.35:</span>&#x2002;Defining Generic Methods    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public static class </span>MathEx            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">static</span> T Max&lt;T&gt;(T first, <span class="CPKeyword">params</span> T[] values)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">where</span> T : IComparable&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      T maximum = first;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">foreach</span> (T item <span class="CPKeyword">in</span> values)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">if</span> (item.CompareTo(maximum) &gt; 0)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              maximum = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">return</span> maximum;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">public</span> <span class="CPKeyword">static</span> T Min&lt;T&gt;(T first, <span class="CPKeyword">params</span> T[] values)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">where</span> T : IComparable&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      T minimum = first;            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">foreach</span> (T item <span class="CPKeyword">in</span> values)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            <span class="CPKeyword">if</span> (item.CompareTo(minimum) &lt; 0)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                minimum = item;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      <span class="CPKeyword">return</span> minimum;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="1904ed9e-bde6-4dcb-a7cd-7a65ea2c3e09" class="element-section paragraph CHAPBMCON" >
In this example, the method is static, although this is not required.</p>














<p data-element-id="8c8f417e-076c-43a5-80fe-885266870e68" class="element-section paragraph CHAPBM" >
Generic methods, like generic types, can include more than one type parameter. The arity (the number of type parameters) is an additional distinguishing characteristic of a method signature. That is, it is legal to have two methods with identical names and formal parameter types, as long as they differ in method type parameter arity.</p>















<div data-element-id="e084e8d6-eeba-4629-a083-df4231ad42cd" class="element-section section-heading H2">
Generic Method Type Inference</div>













<p data-element-id="00f17b9f-aa87-4812-b071-7536250305cd" class="element-section paragraph HEADFIRST" >
Just as type arguments are provided after the type name when using a generic type, so the method type arguments are provided after the method type name. The code used to call the <span class="CITchapbm">Min&lt;T&gt;</span> and <span class="CITchapbm">Max&lt;T&gt;</span> methods looks like that shown in Listing 12.36.</p>















<div data-element-id="7edd3093-e091-4a97-a82f-296258b86e4f" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.36:</span>&#x2002;Specifying the Type Parameter Explicitly    </div>

    <div class="code-block-lines">
            <div class='code-line '>
Console.WriteLine(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    MathEx.Max&lt;<span class="CPKeyword">int</span>&gt;(7, 490));            </div>
            <div class='code-line '>
Console.WriteLine(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    MathEx.Min&lt;<span class="CPKeyword">string</span>&gt;(<span class="Maroon">&quot;R.O.U.S.&quot;</span>, <span class="Maroon">&quot;Fireswamp&quot;</span>));            </div>
    </div>
</div>













<p data-element-id="f1a345b8-2b79-4b7f-953e-917df8918d7c" class="element-section paragraph CHAPBM" >
The results of Listing 12.36 appear in Output 12.4.</p>
















<div data-element-id="fe2345ed-30eb-423d-bae5-64721f11d027" class="element-section output-block-section output-block-top-section output-block-bottom-section">

    <div class="output-block-heading">
Output 12.4    </div>

    <div class="output-block-lines">
            <div class="output-line">
490            </div>
            <div class="output-line">
Fireswamp            </div>
    </div>
</div>












<p data-element-id="1a4208cb-3e7b-4fdc-badf-a959b4703f3e" class="element-section paragraph CHAPBM" >
Not surprisingly, the type arguments, <span class="CITchapbm">int</span> and <span class="CITchapbm">string</span>, correspond to the actual types used in the generic method calls. However, specifying the type arguments is redundant because the compiler can infer the type parameters from the formal parameters passed to the method. Clearly, the caller of <span class="CITchapbm">Max</span> in Listing 12.36 intends the type argument to be <span class="CITchapbm">int</span> because both of the method arguments are of type <span class="CITchapbm">int</span>. To avoid redundancy, you can exclude the type parameters from the call in all cases when the compiler is able to logically infer which type arguments you must have intended. An example of this practice, which is known as <span class="BOLD">method type inference</span>, appears in Listing 12.37. The results appear in Output 12.5.</p>
















<div data-element-id="3b61cdd9-85e2-44f0-90eb-39ce87ec5437" class="element-section output-block-section output-block-top-section output-block-bottom-section">

    <div class="output-block-heading">
Output 12.5    </div>

    <div class="output-block-lines">
            <div class="output-line">
490            </div>
            <div class="output-line">
Fireswamp            </div>
    </div>
</div>













<div data-element-id="30ef83bd-2503-4b6e-b30a-bd0317ad8815" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.37:</span>&#x2002;Inferring the Type Argument from the Arguments    </div>

    <div class="code-block-lines">
            <div class='code-line '>
Console.WriteLine(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    MathEx.Max(7, 490)); <span class="CPComment">// No type arguments!</span>            </div>
            <div class='code-line '>
Console.WriteLine(            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    MathEx.Min(<span class="Maroon">&quot;R.O.U.S&#x27;&quot;</span>, <span class="Maroon">&quot;Fireswamp&quot;</span>));            </div>
    </div>
</div>













<p data-element-id="98d40f02-db07-4e85-8fa4-a3536da88f0d" class="element-section paragraph CHAPBM" >
For method type inference to succeed, the types of the arguments must be &#x201C;matched&#x201D; with the formal parameters of the generic method in such a way that the desired type arguments can be inferred. An interesting question to consider is what happens when contradictory inferences are made. For example, when you call the <span class="CITchapbm">Max&lt;T&gt;</span> method using <span class="CITchapbm">MathEx.Max(7.0, 490)</span>, the compiler could deduce from the first argument that the type argument should be <span class="CITchapbm">double</span>, and it could deduce from the second argument that the type argument is <span class="CITchapbm">int</span>&#x2014;a contradiction. In C# 2.0, this discrepancy would have produced an error. A more sophisticated analysis would notice that the contradiction can be resolved because every <span class="CITchapbm">int</span> can be converted to a <span class="CITchapbm">double</span>, so <span class="CITchapbm">double</span> is the best choice for the type argument. C# 3.0 and C# 4.0 both included improvements to the method type inferencing algorithm that permit the compiler to make these more sophisticated analyses.</p>














<p data-element-id="77b633cb-a8dc-4b51-a80d-7ac3051e866a" class="element-section paragraph CHAPBM" >
In cases where method type inference is still not sophisticated enough to deduce the type arguments, you can resolve the error either by inserting casts on the arguments that clarify to the compiler the argument types that should be used in the inferences or by giving up on type inferencing and including the type arguments explicitly.</p>














<p data-element-id="7c35256e-110e-47e2-8616-720bbc2de7c1" class="element-section paragraph CHAPBM" >
Notice that the method type inference algorithm, when making its inferences, considers only the arguments, the arguments&#x2019; types, and the formal parameter types of the generic method. Other factors that could, in practice, be used in the analysis&#x2014;such as the return type of the generic method, the type of the variable to which the method&#x2019;s returned value is being assigned, or the constraints on the method&#x2019;s generic type parameters&#x2014;are not considered at all by this algorithm.</p>















<div data-element-id="98a00dae-7719-48ac-b04c-0b48695116c8" class="element-section section-heading H2">
Specifying Constraints</div>













<p data-element-id="0544367c-3615-4131-8138-d0a5ea1548e3" class="element-section paragraph HEADFIRST" >
Type parameters of generic methods may be constrained in the same way that type parameters of generic types are constrained. For example, you can restrict a method&#x2019;s type parameter to implement an interface or to be convertible to a class type. The constraints are specified between the parameter list and the method body, as shown in Listing 12.38.</p>















<div data-element-id="547d8625-b82f-40d8-8d10-107994ed59c8" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.38:</span>&#x2002;Specifying Constraints on Generic Methods    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> ConsoleTreeControl            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// Generic method Show&lt;T&gt;</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">public</span> <span class="CPKeyword">static</span> <span class="CPKeyword">void</span> Show&lt;T&gt;(BinaryTree&lt;T&gt; tree, <span class="CPKeyword">int</span> indent)            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">where</span> T :  IComparable&lt;T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Console.WriteLine(<span class="Maroon">&quot;\n{0}{1}&quot;</span>,            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            <span class="Maroon">&quot;&#x2B; --&quot;</span>.PadLeft(5*indent, <span class="Maroon">&#x27; &#x27;</span>),            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            tree.Item.ToString());            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">if</span> (tree.SubItems.First != <span class="CPKeyword">null</span>)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Show(tree.SubItems.First, indent&#x2B;1);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <span class="CPKeyword">if</span> (tree.SubItems.Second != <span class="CPKeyword">null</span>)            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Show(tree.SubItems.Second, indent&#x2B;1);            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="692314c7-e30e-4dc0-92ad-1cd55ab66c96" class="element-section paragraph CHAPBMCON" >
Here, the <span class="CITchapbm">Show&lt;T&gt;</span> implementation itself does not directly use any member of the <span class="CITchapbm">IComparable&lt;T&gt;</span> interface, so you might wonder why the constraint is required. Recall, however, that the <span class="CITchapbm">BinaryTree&lt;T&gt;</span> class did require this constraint (see Listing 12.39).</p>















<div data-element-id="34cac9c4-83f9-40c7-ac34-af0c5daf48a6" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.39:</span>&#x2002;<span class="CITchapbm">BinaryTree&lt;T&gt;</span> Requiring <span class="CITchapbm">IComparable&lt;T&gt;</span> Type Parameters    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> BinaryTree&lt;T&gt;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">where</span> T: System.IComparable&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="22e3fc2d-3f16-4fad-8166-ded561117ed6" class="element-section paragraph CHAPBMCON" >
Because the <span class="CITchapbm">BinaryTree&lt;T&gt;</span> class requires this constraint on its <span class="CITchapbm">T</span>, and because <span class="CITchapbm">Show&lt;T&gt;</span> uses its <span class="CITchapbm">T</span> as a type argument corresponding to a constrained type parameter, <span class="CITchapbm">Show&lt;T&gt;</span> needs to ensure that the constraint on the class&#x2019;s type parameter is met on its method type argument.</p>





















<div data-element-id="eb12a528-01a7-41fd-99da-3106161e3954" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Casting inside a Generic Method</div>





<p data-element-id="22cb638c-032f-4ab8-b45c-3a52366939a0" class="element-section paragraph SF1FIRST" >
Sometimes you should be wary of using generics&#x2014;for instance, when using them specifically to bury a cast operation. Consider the following method, which converts a stream into an object of a given type:</p>














<p data-element-id="c7245ca9-8866-496c-82a7-acae451168e4" class="element-section paragraph SF1MID" >
The <span class="CITchapbm">formatter</span> is responsible for removing data from the stream and converting it to an object. The <span class="CITchapbm">Deserialize()</span> call on the formatter returns data of type <span class="CITchapbm">object</span>. A call to use the generic version of <span class="CITchapbm">Deserialize()</span> looks something like this:</p>














<p data-element-id="3a85c7fb-38c3-4672-8911-c1588690446d" class="element-section paragraph SF1MID" >
The problem with this code is that to the caller of the method, <span class="CITchapbm">Deserialize&lt;T&gt;()</span> appears to be type-safe. However, a cast operation is still performed on behalf of the caller, as in the case of the nongeneric equivalent shown here:</p>














<p data-element-id="5f36970b-10da-433a-a53e-7329c939d3e9" class="element-section paragraph SF1LAST" >
The cast could fail at runtime; the method might not be as type-safe as it appears. The <span class="CITchapbm">Deserialize&lt;T&gt;</span> method is generic solely so that it can hide the existence of the cast from the caller, which seems dangerously deceptive. It might be better for the method to be nongeneric and return <span class="CITchapbm">object</span>, making the caller aware that it is not type-safe. Developers should use care when casting in generic methods if there are no constraints to verify cast validity.</p>














<p data-element-id="12610606-73f0-4b3c-b378-6bba769360ea" class="element-section paragraph SF1MID" >
</p>





















<div data-element-id="7736a003-ec5c-49d1-9f20-7834633f9d86" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">AVOID</span> misleading the caller with generic methods that are not as type-safe as they appear.                </div>
        </div>
    </div>
</div>







<p data-element-id="bfe9cdb0-f5de-41e5-a576-84318a834eef" class="element-section paragraph SF1FIRST" >
</p>










</div>





















<div data-element-id="6cdb01c7-6d4e-4579-a108-4e785845ffd9" class="element-section section-heading H1">
Covariance and Contravariance</div>













<p data-element-id="f671bc26-a8de-4730-b35d-4d354aadb2ed" class="element-section paragraph HEADFIRST" >
A question often asked by new users of generic types is why an expression of type <span class="CITchapbm">List&lt;string&gt;</span> may not be assigned to a variable of type <span class="CITchapbm">List&lt;object&gt;</span>: If a <span class="CITchapbm">string</span> may be converted to type <span class="CITchapbm">object</span>, surely a list of strings is similarly compatible with a list of objects. In reality, this is not, generally speaking, either type-safe or legal. If you declare two variables with different type parameters using the same generic class, the variables are not type-compatible, even if they are assigning from a more specific type to a more generic type&#x2014;in other words, they are not <span class="BOLD">covariant</span>.</p>














<p data-element-id="d20d9e99-c05a-4586-bf44-cb772b481f42" class="element-section paragraph CHAPBM" >
<span class="ITAL">Covariant</span> is a technical term from category theory, but its underlying idea is straightforward: Suppose two types <span class="CITchapbm">X</span> and <span class="CITchapbm">Y</span> have a special relationship&#x2014;namely, that every value of the type <span class="CITchapbm">X</span> may be converted to the type <span class="CITchapbm">Y</span>. If the types <span class="CITchapbm">I&lt;X&gt;</span> and <span class="CITchapbm">I&lt;Y&gt;</span> always also have that same special relationship, we say, &#x201C;<span class="CITchapbm">I&lt;T&gt;</span> is covariant in <span class="CITchapbm">T</span>.&#x201D; When dealing with simple generic types with only one type parameter, the type parameter can be understood such that we simply say, &#x201C;<span class="CITchapbm">I&lt;T&gt;</span> is covariant.&#x201D; The conversion from <span class="CITchapbm">I&lt;X&gt;</span> to <span class="CITchapbm">I&lt;Y&gt;</span> is called a <span class="BOLD">covariant conversion</span>.</p>














<p data-element-id="d0e55fe8-587e-49e8-8099-fe19b9c4a0d8" class="element-section paragraph CHAPBM" >
For example, two instances of a generic class, <span class="CITchapbm">Pair&lt;Contact&gt;</span> and <span class="CITchapbm">Pair&lt;PdaItem&gt;</span>, are not type-compatible even when the type arguments are themselves compatible. In other words, the compiler prevents the conversion (implicit or explicit) of <span class="CITchapbm">Pair&lt;Contact&gt;</span> to <span class="CITchapbm">Pair&lt;PdaItem&gt;</span>, even though <span class="CITchapbm">Contact</span> derives from <span class="CITchapbm">PdaItem</span>. Similarly, converting <span class="CITchapbm">Pair&lt;Contact&gt;</span> to the interface type <span class="CITchapbm">IPair&lt;PdaItem&gt;</span> will fail. See Listing 12.40 for an example.</p>















<div data-element-id="955da2f3-85d7-4649-bce6-5a3c08b16768" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.40:</span>&#x2002;Conversion between Generics with Different Type Parameters    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPComment">// ...</span>            </div>
            <div class='code-line '>
<span class="CPComment">// Error: Cannot convert type ...</span>            </div>
            <div class='code-line '>
Pair&lt;PdaItem&gt; pair = (Pair&lt;PdaItem&gt;) <span class="CPKeyword">new</span> Pair&lt;Contact&gt;();            </div>
            <div class='code-line '>
IPair&lt;PdaItem&gt; duple = (IPair&lt;PdaItem&gt;) <span class="CPKeyword">new</span> Pair&lt;Contact&gt;();            </div>
    </div>
</div>













<p data-element-id="b70fd2e0-c26a-4fc1-b0d3-b85baabb2114" class="element-section paragraph CHAPBM" >
But why is this not legal? Why are <span class="CITchapbm">List&lt;T&gt;</span> and <span class="CITchapbm">Pair&lt;T&gt;</span> not covariant? Listing 12.41 shows what would happen if the C# language allowed unrestricted generic covariance.</p>















<div data-element-id="b209365a-b373-4940-867f-d9e9b8cf1b7e" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.41:</span>&#x2002;Preventing Covariance Maintains Homogeneity    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPComment">//</span>...            </div>
            <div class='code-line '>
Contact contact1 = <span class="CPKeyword">new</span> Contact(<span class="Maroonital">&quot;Princess Buttercup&quot;</span>),            </div>
            <div class='code-line '>
Contact contact2 = <span class="CPKeyword">new</span> Contact(<span class="Maroonital">&quot;Inigo Montoya&quot;</span>);            </div>
            <div class='code-line '>
Pair&lt;Contact&gt; contacts = <span class="CPKeyword">new</span> Pair&lt;Contact&gt;(contact1, contact2);            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">// This gives an error: Cannot convert type ...,</span>            </div>
            <div class='code-line '>
<span class="CPComment">// but suppose it did not</span>            </div>
            <div class='code-line CDThighlight'>
<span class="CPComment">// </span>IPair&lt;PdaItem&gt; pdaPair = (IPair&lt;PdaItem&gt;) contacts;            </div>
            <div class='code-line '>
<span class="CPComment">// This is perfectly legal but not type-safe</span>            </div>
            <div class='code-line CDThighlight'>
<span class="CPComment">// </span>pdaPair.First = <span class="CPKeyword">new</span> Address(<span class="Maroonital">&quot;123 Sesame Street&quot;</span>);<span class="CommentReference"></span>            </div>
            <div class='code-line '>
<span class="CPComment">...</span>            </div>
    </div>
</div>













<p data-element-id="50578f53-74f2-4142-9b69-e088172692d2" class="element-section paragraph CHAPBM" >
An <span class="CITchapbm">IPair&lt;PdaItem&gt;</span> can contain an address, but the object is really a <span class="CITchapbm">Pair&lt;Contact&gt;</span> that can contain only contacts, not addresses. Type safety is completely violated if unrestricted generic covariance is allowed.</p>














<p data-element-id="e21360e2-6e31-4623-b376-b2b808dfed0d" class="element-section paragraph CHAPBM" >
Now it should also be clear why a list of strings may not be used as a list of objects. You cannot insert an integer into a list of strings, but you can insert an integer into a list of objects; thus it must be illegal to cast a list of strings to a list of objects&#x2014;an error the compiler can enforce.</p>




























<div data-element-id="63cc1bd8-6332-4557-a592-fb7e159c41fb" class="element-section section-heading H2">
Enabling Covariance with the <span class="CITchapbm">out</span> Type Parameter Modifier</div>













<p data-element-id="f1f2c6aa-9c85-43f4-a569-a51f3ac98eeb" class="element-section paragraph HEADFIRST" >
You might have noticed that both problems described earlier as consequences of unrestricted covariance arise because the generic pair and the generic list allow their contents to be written. Suppose we eliminated this possibility by creating a read-only <span class="CITchapbm">IReadOnlyPair&lt;T&gt;</span> interface that exposes <span class="CITchapbm">T</span> only as coming &#x201C;out&#x201D; of the interface (i.e., used as the return type of a method or read-only property) and never going &#x201C;into&#x201D; it (i.e., used as a formal parameter or writeable property type). If we restricted ourselves to an &#x201C;out-only&#x201D; interface with respect to <span class="CITchapbm">T</span>, the covariance problem just described would not occur (see Listing 12.42).<span class="FootnoteReference">1</span></p>















<div data-element-id="4bd2ee93-e8c2-4576-9fe1-2bab2b0923da" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.42:</span>&#x2002;Potentially Possible Covariance    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">interface</span> IReadOnlyPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T First { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T Second { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPKeyword">interface</span> IPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T First { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T Second { <span class="CPKeyword">get</span>; <span class="CPKeyword">set</span>; }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPKeyword">public struct</span> Pair&lt;T&gt; : IPair&lt;T&gt;, IReadOnlyPair&lt;T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // ...</span>            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Program            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">static</span> <span class="CPKeyword">void</span> Main()            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Error: Only theoretically possible without</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // the out type parameter modifier</span>            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Pair&lt;Contact&gt; contacts =            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          <span class="CPKeyword">new</span> Pair&lt;Contact&gt;(            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">new</span> Contact(<span class="Maroon">&quot;Princess Buttercup&quot;</span>),            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              <span class="CPKeyword">new</span> Contact(<span class="Maroon">&quot;Inigo Montoya&quot;</span>) );            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      IReadOnlyPair&lt;PdaItem&gt; pair = contacts;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PdaItem pdaItem1 = pair.First;            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      PdaItem pdaItem2 = pair.Second;            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  </span>}            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="1920b524-ab7b-4535-ab85-1e559b017183" class="element-section paragraph CHAPBM" >
When we restrict the generic type declaration to expose data only as it comes out of the interface, there is no reason for the compiler to prevent covariance. All operations on an <span class="CITchapbm">IReadOnlyPair&lt;PdaItem&gt;</span> instance would convert <span class="CITchapbm">Contact</span>s (from the original <span class="CITchapbm">Pair&lt;Contact&gt;</span> object) up to the base class <span class="CITchapbm">PdaItem</span>&#x2014;a perfectly valid conversion. There is no way to &#x201C;write&#x201D; an address into the object that is really a pair of contacts, because the interface does not expose any writeable properties.</p>














<p data-element-id="27c3ccc2-dbc5-4330-8a90-992c2d2343d9" class="element-section paragraph CHAPBM" >
The code in Listing 12.42 still does not compile. However, support for safe covariance was added to C# 4. To indicate that a generic interface is intended to be covariant in one of its type parameters, you can declare the type parameter with the <span class="CITchapbm">out</span> type parameter modifier. Listing 12.43 shows how to modify the interface declaration to indicate that it should be allowed to be covariant.</p>















<div data-element-id="be1aa3c2-0fee-4d0c-a108-d5dd8fafaad3" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.43:</span>&#x2002;Covariance Using the <span class="CITchapbm">out</span> Type Parameter Modifier    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPComment">...</span>            </div>
            <div class='code-line CDThighlight'>
<span class="CPKeyword">interface</span> IReadOnlyPair&lt;<span class="CPKeyword">out</span> T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T First { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  T Second { <span class="CPKeyword">get</span>; }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="e75f5faf-a5fa-4da6-ab73-fb8760ff37f8" class="element-section paragraph CHAPBM" >
Modifying the type parameter on the <span class="CITchapbm">IReadOnlyPair&lt;out T&gt;</span> interface with <span class="CITchapbm">out</span> will cause the compiler to verify that <span class="CITchapbm">T</span> is, indeed, used only for &#x201C;outputs&#x201D;&#x2014;method return types and read-only property return types&#x2014;and never for formal parameters or property setters. From then on, the compiler will allow any covariant conversions involving the interface to succeed. When this modification is made to the code in Listing 12.42, it will compile and execute successfully.</p>














<p data-element-id="bbe35e3c-1840-4212-bde2-bbcf9b31ead9" class="element-section paragraph CHAPBM" >
Several important restrictions are placed on covariant conversions:</p>















<div data-element-id="af1ce448-aef7-4af8-ade2-734b0f147e9d" class="element-section section-heading H2">
Enabling Contravariance with the <span class="CITchapbm">in</span> Type Parameter Modifier</div>













<p data-element-id="027f2f16-64f1-47de-ac45-0f32b525c1d8" class="element-section paragraph HEADFIRST" >
Covariance that &#x201C;goes backward&#x201D; is called <span class="BOLD">contravariance</span>. Again, suppose two types <span class="CITchapbm">X</span> and <span class="CITchapbm">Y</span> are related such that every value of the type <span class="CITchapbm">X</span> may be converted to the type <span class="CITchapbm">Y</span>. If the types <span class="CITchapbm">I&lt;X&gt;</span> and <span class="CITchapbm">I&lt;Y&gt;</span> always have that same special relationship &#x201C;backward&#x201D;&#x2014;that is, every value of the type <span class="CITchapbm">I&lt;Y&gt;</span> can be converted to the type <span class="CITchapbm">I&lt;X&gt;</span>&#x2014;we say that &#x201C;<span class="CITchapbm">I&lt;T&gt;</span> is contravariant in <span class="CITchapbm">T</span>.&#x201D;</p>














<p data-element-id="8eb4fafd-e223-4427-bafb-ad1dc8c7cec2" class="element-section paragraph CHAPBM" >
Most people find that contravariance is much harder to comprehend than covariance is. The canonical example of contravariance is a comparer. Suppose you have a derived type, <span class="CITchapbm">Apple</span>, and a base type, <span class="CITchapbm">Fruit</span>. Clearly, they have the special relationship: Every value of type <span class="CITchapbm">Apple</span> may be converted to <span class="CITchapbm">Fruit</span>.</p>














<p data-element-id="fc128c1b-7750-4b9f-b4af-83c2e461b603" class="element-section paragraph CHAPBM" >
Now suppose you have an interface <span class="CITchapbm">ICompareThings&lt;T&gt;</span> that has a method <span class="CITchapbm">bool FirstIsBetter(T t1, T t2)</span> that takes two <span class="CITchapbm">T</span>s and returns a <span class="CITchapbm">bool</span> saying whether the first one is better than the second one.</p>














<p data-element-id="7f115071-efb6-4b5e-9192-be2c5930f0ff" class="element-section paragraph CHAPBM" >
What happens when we provide type arguments? An <span class="CITchapbm">ICompareThings&lt;Apple&gt;</span> has a method that takes two <span class="CITchapbm">Apple</span>s and compares them. An <span class="CITchapbm">ICompareThings&lt;Fruit&gt;</span> has a method that takes two <span class="CITchapbm">Fruit</span>s and compares them. But since every <span class="CITchapbm">Apple</span> is a <span class="CITchapbm">Fruit</span>, clearly a value of type <span class="CITchapbm">ICompareThings&lt;Fruit&gt;</span> can be safely used anywhere that an <span class="CITchapbm">ICompareThings&lt;Apple&gt;</span> is needed. The direction of the convertibility has been reversed&#x2014;hence the term <span class="ITAL">contravariance</span>.</p>














<p data-element-id="81cedece-f329-40e9-9dde-ed584c3e3c21" class="element-section paragraph CHAPBM" >
Perhaps unsurprisingly, the opposite restrictions to those placed on a covariant interface are necessary to ensure safe contravariance. An interface that is contravariant in one of its type parameters must use that type parameter only in input positions such as formal parameters (or in the types of write-only properties, which are extremely rare). You can mark an interface as being contravariant by declaring the type parameter with the <span class="CITchapbm">in</span> modifier,<span class="FootnoteReference">2</span> as shown in Listing 12.44.</p>















<div data-element-id="d42eb906-a4b1-4431-a60d-2297e47bdd26" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.44:</span>&#x2002;Contravariance Using the <span class="CITchapbm">in</span> Type Parameter Modifier    </div>

    <div class="code-block-lines">
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Fruit {}            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Apple : Fruit {}            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Orange : Fruit {}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line CDThighlight'>
<span class="CPKeyword">interface</span> ICompareThings&lt;<span class="CPKeyword">in</span> T&gt;            </div>
            <div class='code-line CDThighlight'>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;  <span class="CPKeyword">bool</span> FirstIsBetter(T t1, T t2);            </div>
            <div class='code-line CDThighlight'>
            </div>
            <div class='code-line CDThighlight'>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> Program            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">class</span> FruitComparer : ICompareThings&lt;Fruit&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;  { ... }            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">static</span> <span class="CPKeyword">void</span> Main()            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // Allowed in C# 4.0 and later</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ICompareThings&lt;Fruit&gt; fc = <span class="CPKeyword">new</span> FruitComparer();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Apple apple1 = <span class="CPKeyword">new</span> Apple();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Apple apple2 = <span class="CPKeyword">new</span> Apple();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      Orange orange = <span class="CPKeyword">new</span> Orange();            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // A fruit comparer can compare apples and oranges:</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      </span><span class="CPKeyword">bool</span><span class="CPComment"> </span>b1 = fc.FirstIsBetter(apple1, orange);            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // or apples and apples:</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      </span><span class="CPKeyword">bool</span> b2 = fc.FirstIsBetter(apple1, apple2);            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // This is legal because the interface is</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // contravariant</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      ICompareThings&lt;Apple&gt; ac = fc;            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // This is really a fruit comparer, so it can</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      // still compare two apples</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      </span><span class="CPKeyword">bool</span> b3 = ac.FirstIsBetter(apple1, apple2);            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="a04fcb46-aae2-42a6-bc8f-4ef8d1712042" class="element-section paragraph CHAPBM" >
Like covariance support, contravariance uses a type parameter modifier: <span class="CITchapbm">in</span>, which appears in the interface&#x2019;s type parameter declaration. This instructs the compiler to check that <span class="CITchapbm">T</span> never appears on a property getter or as the return type of a method, thereby enabling contravariant conversions for this interface.</p>














<p data-element-id="eee4e5b1-1c88-481f-86d4-9eeff952a577" class="element-section paragraph CHAPBM" >
Contravariant conversions have all the analogous restrictions as described earlier for covariant conversions: They are valid only for generic interface and delegate types, the varying type arguments must be reference types, and the compiler must be able to verify that the interface is safe for the contravariant conversions.</p>














<p data-element-id="b72bd488-196b-426b-8e6b-04ad4b7b49cf" class="element-section paragraph CHAPBM" >
An interface can be covariant in one type parameter and contravariant in another, although this case seldom arises in practice except with delegates. The <span class="CITchapbm">Func&lt;A1, A2, ..., R&gt;</span> family of delegates, for example, are covariant in the return type, <span class="CITchapbm">R</span>, and contravariant in all the argument types.</p>














<p data-element-id="82270c57-bdf1-4095-be38-551b4757ca9c" class="element-section paragraph CHAPBM" >
Lastly, note that the compiler will check the validity of the covariance and contravariance type parameter modifiers throughout the source. Consider the <span class="CITchapbm">IPairInitializer&lt;in T&gt;</span> interface in Listing 12.45.</p>















<div data-element-id="8e6162e5-4b43-4710-a06a-75347d028b7f" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.45:</span>&#x2002;Compiler Validation of Variance    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPComment">// ERROR:  Invalid variance; the type parameter </span><span class="Maroonital">&#x27;T&#x27;</span><span class="CPComment"> is not</span>            </div>
            <div class='code-line '>
<span class="CPComment">//         invariantly valid</span>            </div>
            <div class='code-line '>
<span class="CPKeyword">interface</span> IPairInitializer&lt;<span class="CPKeyword">in</span> T&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  <span class="CPKeyword">void</span> Initialize(IPair&lt;T&gt; pair);            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
<span class="CPComment">// Suppose the code above were legal, and see what goes</span>            </div>
            <div class='code-line '>
<span class="CPComment">// wrong:</span>            </div>
            <div class='code-line '>
<span class="CPKeyword">class</span> FruitPairInitializer : IPairInitializer&lt;Fruit&gt;            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // Let&#x2019;s initialize our pair of fruits with an</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // apple and an orange:</span>            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  </span><span class="CPKeyword">public</span><span class="CPComment"> </span><span class="CPKeyword">void</span> Initialize(IPair&lt;Fruit&gt; pair)            </div>
            <div class='code-line '>
&nbsp;&nbsp;  {            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    pair.First = <span class="CPKeyword">new</span> Orange();            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    pair.Second = <span class="CPKeyword">new</span> Apple();            </div>
            <div class='code-line '>
&nbsp;&nbsp;  }            </div>
            <div class='code-line '>
}            </div>
            <div class='code-line '>
            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // ... later ...</span>            </div>
            <div class='code-line '>
<span class="CPKeyword">&nbsp;&nbsp;  var</span> f = <span class="CPKeyword">new</span> FruitPairInitializer();            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // This would be legal if contravariance were legal:</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  IPairInitializer&lt;Apple&gt; a = f;            </div>
            <div class='code-line '>
<span class="CPComment">&nbsp;&nbsp;  // And now we write an orange into a pair of apples:</span>            </div>
            <div class='code-line '>
&nbsp;&nbsp;  a.Initialize(<span class="CPKeyword">new</span> Pair&lt;Apple&gt;());            </div>
    </div>
</div>













<p data-element-id="d9aafa82-9a7f-4398-8fa3-15ad0b11682d" class="element-section paragraph CHAPBM" >
A casual observer might be tempted to think that since <span class="CITchapbm">IPair&lt;T&gt;</span> is used only as an input formal parameter, the contravariant <span class="CITchapbm">in</span> modifier on <span class="CITchapbm">IPairInitializer</span> is valid. However, the <span class="CITchapbm">IPair&lt;T&gt;</span> interface cannot safely vary, so it cannot be constructed with a type argument that can vary. As you can see, this would not be type-safe and, in turn, the compiler disallows the <span class="CITchapbm">IPairInitializer&lt;T&gt;</span> interface from being declared as contravariant in the first place.</p>















<div data-element-id="4b60fad3-c7be-42cc-9342-c6fcf14955bd" class="element-section section-heading H2">
Support for Unsafe Covariance in Arrays</div>













<p data-element-id="eadb0c8a-ff71-452a-9fd9-b6b2581914a6" class="element-section paragraph HEADFIRST" >
So far, we have described covariance and contravariance as being properties of generic types. Of all the nongeneric types, arrays are most like generics; that is, just as we think of a generic &#x201C;list of <span class="CITchapbm">T</span>&#x201D; or a generic &#x201C;pair of <span class="CITchapbm">T</span>,&#x201D; so we can think of an &#x201C;array of <span class="CITchapbm">T</span>&#x201D; as demonstrating the same sort of pattern. Since arrays clearly support both reading and writing, given what you know about covariance and contravariance, you probably would suppose that arrays may be neither safely contravariant nor covariant. That is, you might imagine that an array can be safely covariant only if it is never written to and safely contravariant only if it is never read from&#x2014;though neither seems like a realistic restriction.</p>














<p data-element-id="5b118229-1edf-4d96-b5d1-31e464f4eeae" class="element-section paragraph CHAPBM" >
Unfortunately, C# does support array covariance, even though doing so is not type-safe. For example, <span class="CITchapbm">Fruit[] fruits = new Apple[10];</span> is perfectly legal in C#. If you then include the expression <span class="CITchapbm">fruits[0] = new Orange();</span>, the runtime will issue a type-safety violation in the form of an exception. It is deeply disturbing that it is not always legal to assign an <span class="CITchapbm">Orange</span> into an array of <span class="CITchapbm">Fruit</span> because it might really be an array of <span class="CITchapbm">Apple</span>s, but that is the situation not just in C# but in all CLR languages that use the runtime&#x2019;s implementation of arrays.</p>














<p data-element-id="2ded971d-a864-4a8f-94f0-fd298f9c9e15" class="element-section paragraph CHAPBM" >
You should try to avoid using unsafe array covariance. Every array is convertible to the read-only (and therefore safely covariant) interface <span class="CITchapbm">IEnumerable&lt;T&gt;</span>; that is, <span class="CITchapbm">IEnumerable&lt;Fruit&gt; fruits = new Apple[10]</span> is both safe and legal because there is no way to insert an <span class="CITchapbm">Orange</span> into the array if all you have is the read-only interface.</p>





















<div data-element-id="33ac77a5-4af8-415d-9c56-2f178bf905d9" class="element-section guidelines-block">

    <div class="upper-left-square dark-gray-square"></div>

    <div class=inside-guidelines-block> 
        <div class="guidelines-block-heading">
Guidelines        </div>

        <div class="guidelines-block-lines">
        
                <div class="guidelines-block-line">
<span class="BOLD">AVOID</span> unsafe array covariance. Instead, <span class="BOLD">CONSIDER</span> converting the array to the read-only interface <span class="CITchapbm">IEnumerable&lt;T&gt;</span>, which can be safely converted via covariant conversions.                </div>
        </div>
    </div>
</div>





















<div data-element-id="e520b148-7c7a-4597-899a-645db60e4998" class="element-section section-heading H1">
Generic Internals</div>













<p data-element-id="eecc8ca9-76e7-45b1-bb67-7888a036ab1c" class="element-section paragraph HEADFIRST" >
Given the discussions in earlier chapters about the prevalence of objects within the CLI type system, it should come as no surprise to learn that generics are also objects. In fact, the type parameter on a generic class becomes metadata that the runtime uses to build appropriate classes when needed. Generics, therefore, support inheritance, polymorphism, and encapsulation. With generics, you can define methods, properties, fields, classes, interfaces, and delegates.</p>














<p data-element-id="3e586132-6b11-483f-a9a1-e760b11aafbf" class="element-section paragraph CHAPBM" >
To achieve this, generics require support from the underlying runtime. In turn, the addition of generics to the C# language is a feature of both the compiler and the framework. To avoid boxing, for example, the implementation of generics is different for value-based type parameters than for generics with reference type parameters.</p>





















<div data-element-id="420a4c6a-2507-4567-b172-808fe05cf48d" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">CIL Representation of Generics</div>





<p data-element-id="4748bb3a-a872-452e-9935-94a5f139c720" class="element-section paragraph SF1FIRST" >
When a generic class is compiled, it is not significantly different from a nongeneric class. The result of the compilation consists of just metadata and CIL. The CIL is parameterized to accept a user-supplied type somewhere in code. As an example, suppose you had a simple <span class="CITchapbm">Stack</span> class declared as shown in Listing 12.46.</p>















<div data-element-id="b07a1e7b-382b-4d52-b2d6-4322d5db7779" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.46:</span>&#x2002;<span class="CITchapbm">Stack&lt;T&gt;</span> Declaration    </div>

    <div class="code-block-lines">
            <div class='code-line '>
<span class="CPKeyword">public</span> <span class="CPKeyword">class</span> Stack&lt;T&gt; <span class="CPKeyword">where</span> T : IComparable            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPKeyword">private</span> T[] _Items;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="CPComment">// rest of the class here</span>            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="5877c265-1623-4fea-914b-c18e25a906b7" class="element-section paragraph SF1MID" >
When you compile the class, the generated CIL is parameterized and looks something like Listing 12.47.</p>















<div data-element-id="416002a6-3fd1-4a16-8a47-725fa8f624c5" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.47:</span>&#x2002;CIL Code for <span class="CITchapbm">Stack&lt;T&gt;</span><span class="CommentReference"></span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
.class public auto ansi beforefieldinit            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    Stack&#x27;1&lt;([ System.Private.CoreLib]System.IComparable) T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    extends [System.Private.CoreLib]System.Object            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line '>
&nbsp;&nbsp;  ...            </div>
            <div class='code-line '>
}            </div>
    </div>
</div>













<p data-element-id="d50abcec-70d7-46ed-9444-c18ffa2a3079" class="element-section paragraph SF1MID" >
The first notable item is the <span class="CITchapbm">&#x27;1</span> that appears following <span class="CITchapbm">Stack</span> on the second line. That number is the arity of the generic types: It declares the number of type parameters for which the generic class will require type arguments. A declaration such as <span class="CITchapbm">EntityDictionary&lt;TKey, TValue&gt;</span> would have an arity of 2.</p>














<p data-element-id="2144c3c7-0682-425d-883e-a7b5cea5e0b0" class="element-section paragraph SF1MID" >
The second line of the generated CIL shows the constraints imposed upon the class. The <span class="CITchapbm">T</span> type parameter is decorated with an interface declaration for the <span class="CITchapbm">IComparable</span> constraint.</p>














<p data-element-id="f9d5cb53-3422-482e-a62b-27fbb08bd7a2" class="element-section paragraph SF1MID" >
If you continue looking through the CIL, you will find that the item&#x2019;s array declaration of type <span class="CITchapbm">T</span> is altered to contain a type parameter using <span class="ITAL">exclamation point notation</span>, which is featured in the generics-capable version of the CIL. The exclamation point denotes the presence of the first type parameter specified for the class, as shown in Listing 12.48.</p>















<div data-element-id="11e55a23-efdb-45ee-be17-212f3b6346cf" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.48:</span>&#x2002;CIL with Exclamation Point Notation to Support Generics    </div>

    <div class="code-block-lines">
            <div class='code-line '>
.class public auto ansi beforefieldinit            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     Stack`1&lt;([System.Private.CoreLib]System.IComparable) T&gt;            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     extends [System.Private.CoreLib]System.Object            </div>
            <div class='code-line '>
{            </div>
            <div class='code-line CDThighlight'>
&nbsp;&nbsp;&nbsp;&nbsp;    .field private !T[] _Items            </div>
            <div class='code-line '>
&nbsp;&nbsp;&nbsp;&nbsp;    ...            </div>
            <div class='code-line '>
}<span class="CommentReference"></span>            </div>
    </div>
</div>













<p data-element-id="b25f9553-8d8c-45c7-a8d2-bd11a3f97ecc" class="element-section paragraph SF1LAST" >
Beyond the inclusion of the arity and type parameter in the class header and the type parameter denoted with exclamation points in code, there is little difference between the CIL generated for a generic class and the CIL generated for a nongeneric class.</p>










</div>














<div data-element-id="f3e69c1e-c676-4d75-a523-0df7e20dd05a" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Instantiating Generics Based on Value Types</div>





<p data-element-id="1959177f-77a2-43f6-b26b-124ed29e324c" class="element-section paragraph SF1FIRST" >
When a generic type is first constructed with a value type as a type parameter, the runtime creates a specialized generic type with the supplied type parameter(s) placed appropriately in the CIL. Therefore, the runtime creates new specialized generic types for each new parameter value type.</p>














<p data-element-id="e2bb3be4-a675-4dbd-a328-685c54273778" class="element-section paragraph SF1MID" >
For example, suppose some code declared a <span class="CITchapbm">Stack</span> constructed of integers, as shown in Listing 12.49.</p>















<div data-element-id="4e4e57b2-7274-40a6-8879-c5111f534351" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.49:</span>&#x2002;<span class="CITchapbm">Stack&lt;int&gt;</span> Definition    </div>

    <div class="code-block-lines">
            <div class='code-line '>
Stack&lt;<span class="CPKeyword">int</span>&gt; stack;            </div>
    </div>
</div>













<p data-element-id="a381c4fb-0d05-422f-a5ea-8554b85e82f6" class="element-section paragraph SF1MID" >
When using this type, <span class="CITchapbm">Stack&lt;int&gt;</span>, for the first time, the runtime generates a specialized version of the <span class="CITchapbm">Stack</span> class with the type argument <span class="CITchapbm">int</span> substituted for its type parameter. From then on, whenever the code uses a <span class="CITchapbm">Stack&lt;int&gt;</span>, the runtime reuses the generated specialized <span class="CITchapbm">Stack&lt;int&gt;</span> class. In Listing 12.50, you declare two instances of a <span class="CITchapbm">Stack&lt;int&gt;</span>, both using the code already generated by the runtime for a <span class="CITchapbm">Stack&lt;int&gt;</span>.</p>















<div data-element-id="191fbc30-632b-44c9-bf34-44738c5d632b" class="element-section code-block-top-section code-block-bottom-section code-block-section">

    <div class="code-block-heading">
<span class="CDTNUM">Listing 12.50:</span>&#x2002;Declaring Variables of Type <span class="CITchapbm">Stack&lt;T&gt;</span>    </div>

    <div class="code-block-lines">
            <div class='code-line '>
Stack&lt;<span class="CPKeyword">int</span>&gt; stackOne = <span class="CPKeyword">new</span> Stack&lt;<span class="CPKeyword">int</span>&gt;();            </div>
            <div class='code-line '>
Stack&lt;<span class="CPKeyword">int</span>&gt; stackTwo = <span class="CPKeyword">new</span> Stack&lt;<span class="CPKeyword">int</span>&gt;();            </div>
    </div>
</div>













<p data-element-id="52b81e43-f7e0-471f-853b-3f3c38d5c5df" class="element-section paragraph SF1LAST" >
If, later in the code, you create another <span class="CITchapbm">Stack</span> with a different value type substituted for the type parameter (such as a <span class="CITchapbm">long</span> or a user-defined <span class="CITchapbm">struct</span>), the runtime will generate another version of the generic type. The benefit of specialized value type classes is better performance. Furthermore, the code can avoid conversions and boxing because each specialized generic class natively contains the value type.</p>










</div>














<div data-element-id="7aa1ed61-3fe1-4feb-8445-1faac6d2c161" class="element-section skill-topic-block skill-topic-block-top skill-topic-block-bottom">
    <img class="skill-topic-overlayed-squares" src="data:image/svg&#x2B;xml;base64,PHN2ZyB3aWR0aD0iMjk2IiBoZWlnaHQ9IjEyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgb3ZlcmZsb3c9ImhpZGRlbiI&#x2B;DQogICAgPGRlZnM&#x2B;DQogICAgICAgIDxjbGlwUGF0aCBpZD0iY2xpcDAiPg0KICAgICAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSIyOTYiIGhlaWdodD0iMTIxIiAvPg0KICAgICAgICA8L2NsaXBQYXRoPg0KICAgIDwvZGVmcz4NCiAgICA8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDEzIC0yNzIpIj4NCiAgICAgICAgPHJlY3QgeD0iNDEzIiB5PSIyNzIiIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzMzMzMzMyIgLz4NCiAgICAgICAgPHJlY3QgeD0iNDY4IiB5PSIzMjciIHdpZHRoPSI1NSIgaGVpZ2h0PSI1NSIgZmlsbD0iIzgwODA4MCIgLz4NCiAgICA8L2c&#x2B;DQo8L3N2Zz4="/>
    <div class="skill-topic-heading">AdVanced Topic</div>
    <div class="skill-topic-sub-heading">Instantiating Generics Based on Reference Types</div>





<p data-element-id="e8901672-5cf7-4685-b0e6-56afaa70bbaf" class="element-section paragraph SF1FIRST" >
Generics work slightly differently for reference types. The first time a generic type is constructed with a reference type, the runtime creates a specialized generic type with <span class="CITchapbm">object</span> references substituted for type parameters in the CIL, rather than a specialized generic type based on the type argument. Each subsequent time a constructed type is instantiated with a reference type parameter, the runtime reuses the previously generated version of the generic type, even if the reference type is different from the first reference type.</p>














<p data-element-id="6c160733-8c41-488f-8892-12fb26557b44" class="element-section paragraph SF1MID" >
For example, suppose you have two reference types: a <span class="CITchapbm">Customer</span> class and an <span class="CITchapbm">Order</span> class. Next, you create an <span class="CITchapbm">EntityDictionary</span> of <span class="CITchapbm">Customer</span> types:</p>














<p data-element-id="11d9bef4-52a1-40a6-bd9c-909e78ab74d4" class="element-section paragraph SF1DPGMONLY" >
EntityDictionary&lt;Guid, Customer&gt; customers;</p>














<p data-element-id="b00bfbbe-09b3-4eb0-8244-158ea8b389fc" class="element-section paragraph SF1MID" >
Prior to accessing this class, the runtime generates a specialized version of the <span class="CITchapbm">EntityDictionary</span> class that, instead of storing <span class="CITchapbm">Customer</span> as the specified data type, stores <span class="CITchapbm">object</span> references. Suppose the next line of code creates an <span class="CITchapbm">EntityDictionary</span> of another reference type, called <span class="CITchapbm">Order</span>:</p>














<p data-element-id="2fde3bbe-9daf-4393-8b9f-90650aaf4b44" class="element-section paragraph SF1MID" >
Unlike with value types, no new specialized version of the <span class="CITchapbm">EntityDictionary</span> class is created for the <span class="CITchapbm">EntityDictionary</span> that uses the <span class="CITchapbm">Order</span> type. Instead, an instance of the version of <span class="CITchapbm">EntityDictionary</span> that uses <span class="CITchapbm">object</span> references is instantiated and the <span class="CITchapbm">orders</span> variable is set to reference it. </p>














<p data-element-id="89c5ebde-c385-4194-b78a-b3d1d81c71a1" class="element-section paragraph SF1MID" >
To still gain the advantage of type safety, for each object reference substituted in place of the type parameter, an area of memory for an <span class="CITchapbm">Order</span> type is specifically allocated and the pointer is set to that memory reference. Suppose you then encountered a line of code to instantiate an <span class="CITchapbm">EntityDictionary</span> of a <span class="CITchapbm">Customer</span> type as follows:</p>














<p data-element-id="38fe186c-327b-46ea-9430-d3d50f9fadfd" class="element-section paragraph SF1DPGMONLY" >
customers = new EntityDictionary&lt;Guid, Customer&gt;();</p>














<p data-element-id="51ab969b-7f37-4c26-a1af-e953c70dd4be" class="element-section paragraph SF1MID" >
As with the previous use of the <span class="CITchapbm">EntityDictionary</span> class created with the <span class="CITchapbm">Order</span> type, another instance of the specialized <span class="CITchapbm">EntityDictionary</span> class (the one based on <span class="CITchapbm">object</span> references) is instantiated and the pointers contained therein are set to reference a <span class="CITchapbm">Customer</span> type specifically. This implementation of generics greatly reduces code bloat by ensuring that the compiler creates only one specialized class for generic classes of reference types.</p>














<p data-element-id="e8fa9bbf-62e0-40cc-847c-008e80cff952" class="element-section paragraph SF1LAST" >
Even though the runtime uses the same internal generic type definition when the type parameter on a generic reference type varies, this behavior is superseded if the type parameter is a value type. <span class="CITchapbm">Dictionary&lt;int, Customer&gt;</span>, <span class="CITchapbm">Dictionary&lt;Guid, Order&gt;</span>, and <span class="CITchapbm">Dictionary&lt;long, Order&gt;</span> will require new internal type definitions, for example.</p>






















<div data-element-id="f3089e9c-0508-4656-bae2-93178f8dfd6c" class="element-section language-contrast-block">

    <div class="upper-left-square light-gray-square"></div>

    <div class=inside-language-contrast-block> 
        <div class="language-contrast-heading">
Language Contrast: Java&#x2014;Generics        </div>

        <div class="language-contrast-lines">
        
                <div class="language-contrast-line">
The implementation of generics in Java occurs entirely within the compiler, not within the Java Virtual Machine. Sun Microsystems, which originally developed Java (long before Oracle took it over), adopted this approach to ensure that no updated Java Virtual Machine would need to be distributed because generics were used.                </div>
                <div class="language-contrast-line">
The Java implementation uses syntax like the templates in C&#x2B;&#x2B; and the generics in C#, including type parameters and constraints. Because it does not treat value types differently from reference types, however, the unmodified Java Virtual Machine cannot support generics for value types. As such, generics in Java do not offer the same gains in execution efficiency as they do in C#. Indeed, whenever the Java compiler needs to return data, it injects automatic downcasts from the specified constraint, if one is declared, or the base <span class="CITchapbm">Object</span> type, if a constraint is not declared. Further, the Java compiler generates a single specialized type at compile time, which it then uses to instantiate any constructed type. Finally, because the Java Virtual Machine does not support generics natively, there is no way to ascertain the type parameter for an instance of a generic type at execution time, and other uses of reflection are severely limited.                </div>
        </div>
    </div>
</div>


</div>





















<div data-element-id="a5fce2b1-a5db-4cad-b786-8a9bced45ab0" class="element-section section-heading SummaryHead">
Summary</div>













<p data-element-id="3eaa0caf-9c90-4af7-84c0-cbb948555471" class="element-section paragraph HEADFIRST" >
The addition of generic types and methods to C# 2.0 fundamentally transformed the coding style of C# developers. In almost all cases in which programmers used <span class="CITchapbm">object</span> within C# 1.0 code, generics became a better choice in C# 2.0. In modern C# programs, using <span class="CITchapbm">object</span> (particularly in the context of any collection type) should make you consider whether the problem would be better solved with generics. The increased type safety enabled by the elimination of casts, the elimination of the boxing performance penalty, and the reduction of repeated code are all significant improvements.</p>














<p data-element-id="a9b71922-d45f-4e7e-bc52-8987514ea7b6" class="element-section paragraph CHAPBM" >
Chapter 15 looks more at the most pervasive generic namespaces, <span class="CITchapbm">System.Collections.Generic</span>. As its name implies, this namespace is composed almost exclusively of generic types. It provides clear examples of how some types that originally used objects were then converted to use generics. However, before we tackle these topics, we will investigate expressions, which provide a significant C# 3.0 (and later) improvement for working with collections.</p>
































<div data-element-id="ad4145de-39c2-4895-8362-738f8e4ed8bc" class="element-section footnote-block">
    1
<span class="FootnoteReference"></span> This capability was introduced in C# 4.0.</div>














<div data-element-id="85aa040d-c4b4-4d94-ae19-b8b553a53980" class="element-section footnote-block">
    2
<span class="FootnoteReference"></span> Introduced in C# 4.0.</div>





        </div>
    </div>
</body>
</html>
